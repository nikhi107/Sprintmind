[
  {
    "id": 6835,
    "title": "why requests.session doesn't send stored cookie?",
    "body": "Here is a reproducible example:\r\n\r\n- server.py\r\n\r\n```python\r\nfrom flask import request, make_response, Flask\r\nimport json as j\r\n\r\napp = Flask(__name__)\r\n\r\n@app.route('/set')\r\ndef set_cookie():\r\n  cookie = {}\r\n  resp = make_response('')\r\n  for k, v in request.args.items():\r\n    resp.set_cookie(k, v, domain='localhost', samesite='lax', secure=False)\r\n  return resp\r\n\r\n@app.route('/get')\r\ndef get_cookie():\r\n  cookie = j.dumps(dict(request.cookies), indent=2)\r\n  print('Cookie:', cookie)\r\n  return cookie\r\n\r\nif __name__ == \"__main__\":\r\n    app.run(host='0.0.0.0')\r\n```\r\n\r\n- client.py\r\n\r\n```python\r\nfrom requests import session as s\r\n\r\nsession = s()\r\n\r\nresponse1 = session.get('http://localhost:5000/set?AAA=BBB&EEE=FFF')\r\n\r\nprint('Response headers:', response1.headers)\r\nprint('Session cookies:', session.cookies)\r\n\r\nresponse2 = session.get('http://localhost:5000/get')\r\n\r\nprint('Second request headers:', response2.request.headers)\r\n```\r\n\r\nAnd logs:\r\n\r\n- SERVER\r\n\r\n```text\r\n127.0.0.1 - - [29/Nov/2024 14:19:55] \"GET /set?AAA=BBB&EEE=FFF HTTP/1.1\" 200 -\r\nCookie: {}\r\n127.0.0.1 - - [29/Nov/2024 14:19:55] \"GET /get HTTP/1.1\" 200 -\r\n```\r\n\r\n- CLIENT\r\n\r\n```text\r\nResponse headers: {'Server': 'Werkzeug/3.0.1 Python/3.11.7', 'Date': 'Fri, 29 Nov 2024 05:19:55 GMT', 'Content-Type': 'text/html; charset=utf-8', 'Content-Length': '0', 'Set-Cookie': 'AAA=BBB; Domain=localhost; Path=/; SameSite=Lax, EEE=FFF; Domain=localhost; Path=/; SameSite=Lax', 'Connection': 'close'}\r\nSession cookies: <RequestsCookieJar[<Cookie AAA=BBB for .localhost/>, <Cookie EEE=FFF for .localhost/>]>\r\nSecond request headers: {'User-Agent': 'python-requests/2.31.0', 'Accept-Encoding': 'gzip, deflate', 'Accept': '*/*', 'Connection': 'keep-alive'}\r\n```\r\n\r\nWhy `session` doesn't send stored cookies at second request? More over, why domain looks like `.localhost` inside session cookies. I set it as `Domain=localhost` (without leading dot).\r\n\r\nrequests version - 2.31.0",
    "labels": [],
    "state": "closed",
    "repo": "requests/requests"
  },
  {
    "id": 6833,
    "title": "Lack of respect for questions and support requests",
    "body": "Sincerely, I don't know what is the objective of those responsible for https://github.com/psf/requests, if they don't know how to kill this project, if they are bored or if they are simply busier with other things.\r\n\r\nI have been observing your behavior for some time now, and it worries me:\r\n\r\n.- Don't you have time to develop this library?: **perfect**.\r\n.- Don't you want to continue to be responsible for it?: **perfect**.\r\n.- Don't you know how to respond to support requests?: **perfect**.\r\n\r\nBut don't automatically refer support requests or problems to https://stackoverflow.com/: one of the most aggressive and rude sites when faced with support questions, especially from those who are just starting to program.\r\n\r\nYou should rethink, seriously, what to do with https://github.com/psf/requests: it is **far** behind other libraries that provide current functionalities, it is **far** behind for commits that really provide usefulness (you have been *months* without contributing anything useful to this library).\r\n\r\nIf you are tired, **perfect**: say it widely. And allow others to **continue** the work: people with enthusiasm and time to maintain and improve this library as it deserves.\r\n\r\nBecause our time is also **important**: don't give an image of an updated, friendly and supported library; because that's not the reality I see.\r\n\r\nAnd this is said by someone who has recognized all your work: but sometimes it is **wise** to know when to give way to other people. And I maintain, on github, a project infinitely smaller than yours, but the moment I lose the illusion, the desire, the smile, to respond to every PR, every Issue, every suggestion, at that moment I will **hang up the gloves**, allowing wiser people to continue the path.\r\n\r\n\r\nRegards,",
    "labels": [],
    "state": "closed",
    "repo": "requests/requests"
  },
  {
    "id": 6823,
    "title": "chunked put using a generator function...",
    "body": "<!-- Summary. -->\r\nI made a generator function that returns str chunks; I passed it to data [...data=my_func()...], and it eventually comes back with the error \"memoryview: a bytes-like object is required, not 'str'\" (debug statements indicate this is happening on the first yield...)\r\n\r\nDocumentation indicates this is the way to do it: [https://docs.python-requests.org/en/latest/user/advanced/#chunk-encoded-requests](https://docs.python-requests.org/en/latest/user/advanced/#chunk-encoded-requests)\r\n\r\n## Expected Result\r\n\r\n<!-- What you expected. -->\r\nNo error!\r\n\r\n## Actual Result\r\n\r\n<!-- What happened instead. -->\r\nThe error \"memoryview: a bytes-like object is required, not 'str'\".\r\n## Reproduction Steps\r\n\r\n```python\r\nimport requests\r\n\r\ndef test():\r\n    json_preamble='{\"field\": \"value\",'\r\n    def put()->str:\r\n        yield json_preamble\r\n\r\n        return '\"field2\": \"value2\"}' # final chunk...\r\n\r\n    response=requests.put(some_url, data=put(), headers=some_headers)\r\n\r\ntest ()\r\n```\r\n\r\n## System Information\r\n\r\n    $ python -m requests.help\r\n\r\n```json\r\n{\r\n  \"chardet\": {\r\n    \"version\": \"5.1.0\"\r\n  },\r\n  \"charset_normalizer\": {\r\n    \"version\": \"3.0.1\"\r\n  },\r\n  \"cryptography\": {\r\n    \"version\": \"38.0.4\"\r\n  },\r\n  \"idna\": {\r\n    \"version\": \"3.3\"\r\n  },\r\n  \"implementation\": {\r\n    \"name\": \"CPython\",\r\n    \"version\": \"3.11.2\"\r\n  },\r\n  \"platform\": {\r\n    \"release\": \"6.1.0-26-amd64\",\r\n    \"system\": \"Linux\"\r\n  },\r\n  \"pyOpenSSL\": {\r\n    \"openssl_version\": \"30000080\",\r\n    \"version\": \"23.0.0\"\r\n  },\r\n  \"requests\": {\r\n    \"version\": \"2.28.1\"\r\n  },\r\n  \"system_ssl\": {\r\n    \"version\": \"300000e0\"\r\n  },\r\n  \"urllib3\": {\r\n    \"version\": \"1.26.12\"\r\n  },\r\n  \"using_charset_normalizer\": false,\r\n  \"using_pyopenssl\": true\r\n}\r\n```\r\n\r\n<!-- This command is only available on Requests v2.16.4 and greater. Otherwise,\r\nplease provide some basic information about your system (Python version,\r\noperating system, &c). -->\r\n",
    "labels": [],
    "state": "closed",
    "repo": "requests/requests"
  },
  {
    "id": 2766,
    "title": "Document threading contract for Session class",
    "body": "Right now, it's quite difficult to figure out if the Session class is threadsafe or not. The docs don't say, apart from a \"thread-safe\" bullet on the home page. Google led me to http://stackoverflow.com/questions/18188044/is-the-session-object-from-pythons-requests-library-thread-safe, whose first answer boils down to \"be very careful\".\n\nInspired by that SO author, I've been auditing the code myself, and have come to the conclusion that Session is probably not threadsafe. (The use of `self.redirect_cache` set off red flags for me.) Reading through other requests bug reports, I see maintainers recommending one Session per thread, which implies that it's not threadsafe.\n\nThe documentation should clarify this and recommend how to use Session in multithreaded programs. Possible text:\n\n```\nSession is not threadsafe. If you are using requests with an explicit Session\nobject in a multithreaded program, you should create one Session per thread.\n```\n\nIf that's accurate, let me know and I'll submit a PR.\n\nAlso, I think the \"thread-safe\" bullet should be removed from the home page, or maybe replaced by \"thread-safe in certain circumstances\".\n",
    "labels": [
      "Documentation"
    ],
    "state": "closed",
    "repo": "requests/requests"
  },
  {
    "id": 7033,
    "title": "requests with self signed certs broken",
    "body": "specifying a cert bundle in 2.28.1 works fine, but in 2.32.5 fails with requests.exceptions.SSLError\n\n## Expected Result\n\nResponse 200\n\n## Actual Result\n\nTraceback (most recent call last):\n  File \"<stdin>\", line 1, in <module>\n  File \"/usr/local/lib/python3.11/site-packages/requests/api.py\", line 73, in get\n    return request(\"get\", url, params=params, **kwargs)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/requests/api.py\", line 59, in request\n    return session.request(method=method, url=url, **kwargs)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/requests/sessions.py\", line 589, in request\n    resp = self.send(prep, **send_kwargs)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/requests/sessions.py\", line 703, in send\n    r = adapter.send(request, **kwargs)\n        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/requests/adapters.py\", line 675, in send\n    raise SSLError(e, request=request)\nrequests.exceptions.SSLError: HTTPSConnectionPool(host='lal-apps', port=443): Max retries exceeded with url: / (Caused by SSLError(SSLError(1, '[SSL: SSLV3_ALERT_HANDSHAKE_FAILURE] sslv3 alert handshake failure (_ssl.c:1016)')))\n\n## Reproduction Steps\n\n```python\nimport requests\nurl = '<YOUR SERVER WITH A SELF SIGNED CERT'\nr = requests.get(url)\n```\n\n## System Information\n\n    REQUESTS_CA_BUNDLE set to valid cert bundle, works with 2.28.1\n\n```json\n{\n  \"chardet\": {\n    \"version\": null\n  },\n  \"charset_normalizer\": {\n    \"version\": \"3.4.3\"\n  },\n  \"cryptography\": {\n    \"version\": \"\"\n  },\n  \"idna\": {\n    \"version\": \"3.10\"\n  },\n  \"implementation\": {\n    \"name\": \"CPython\",\n    \"version\": \"3.11.12\"\n  },\n  \"platform\": {\n    \"release\": \"5.14.0-503.22.1.el9_5.x86_64\",\n    \"system\": \"Linux\"\n  },\n  \"pyOpenSSL\": {\n    \"openssl_version\": \"\",\n    \"version\": null\n  },\n  \"requests\": {\n    \"version\": \"2.32.5\"\n  },\n  \"system_ssl\": {\n    \"version\": \"1010117f\"\n  },\n  \"urllib3\": {\n    \"version\": \"2.5.0\"\n  },\n  \"using_charset_normalizer\": true,\n  \"using_pyopenssl\": false\n}\n```\n\n\n",
    "labels": [
      "Propose Close",
      "Needs More Information"
    ],
    "state": "closed",
    "repo": "requests/requests"
  },
  {
    "id": 7079,
    "title": "Feature Request: Add built-in logger hooks for all HTTP requests and responses",
    "body": "It would be helpful if the requests library provided an easy and consistent way to log every outgoing request and incoming response without manually wrapping or subclassing Session objects.\n\nMotivation\n\nMany developers (especially in production systems, microservices, and debugging tools) need to:\n\nTrace outgoing requests (URLs, methods, headers, payloads)\n\nLog response details (status code, latency, headers, etc.)\n\nIntegrate logs with frameworks like logging, structlog, or jsonlogger",
    "labels": [
      "Feature Request",
      "actions/autoclose-feat"
    ],
    "state": "closed",
    "repo": "requests/requests"
  },
  {
    "id": 6804,
    "title": "XML gets shortened when submitting a post request",
    "body": "I am trying to send an xml in a post request to a SOAP endpoint of a TMS server.\r\nThe code is the following:\r\n\r\n```\r\nresponse = requests.post(\r\n        url,\r\n        data=xml_output,\r\n        headers={\"Content-Type\": \"text/xml\"},\r\n        timeout=60,\r\n        cert=(cert_file, decrypted_key_file),\r\n    )\r\n```\r\nThe server returns a response saying that it got an unexpected end of input in lixe x, char y. The error is dependent on the size of the xml, but is reproducible.\r\n\r\nI am attaching 2 XMLs as examples:\r\n\r\nEX 1:\r\n\r\n```\r\n<?xml version=\"1.0\" ?>\r\n<soapenv:Envelope xmlns:soapenv=\"http://schemas.xmlsoap.org/soap/envelope/\" xmlns:tms=\"urn:CDM/tmsIntegrationService/\" xmlns:sh=\"http://www.unece.org/cefact/namespaces/StandardBusinessDocumentHeader\">\r\n   <soapenv:Header>\r\n      <wsse:Security xmlns:wsse=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-secext-1.0.xsd\">\r\n         <wsse:UsernameToken>\r\n            <wsse:Username>xxx_xxx</wsse:Username>\r\n            <wsse:Password>xxxxxxxxxxxxxxxxxxxx</wsse:Password>\r\n         </wsse:UsernameToken>\r\n      </wsse:Security>\r\n   </soapenv:Header>\r\n   <soapenv:Body>\r\n      <tms:transportInstructionMessage>\r\n         <sh:StandardBusinessDocumentHeader>\r\n            <sh:HeaderVersion>1</sh:HeaderVersion>\r\n            <sh:Sender>\r\n               <sh:Identifier>PAWE\u0141 ZAB\u0141OCKI ZAB\u0141OCKI I PARTNERZY</sh:Identifier>\r\n            </sh:Sender>\r\n            <sh:Receiver>\r\n               <sh:Identifier>Test Identifier</sh:Identifier>\r\n            </sh:Receiver>\r\n            <sh:DocumentIdentification>\r\n               <sh:Standard>GS1</sh:Standard>\r\n               <sh:TypeVersion>3.2</sh:TypeVersion>\r\n               <sh:InstanceIdentifier>100002</sh:InstanceIdentifier>\r\n               <sh:Type>Transport Instruction</sh:Type>\r\n               <sh:CreationDateAndTime>2024-10-01T07:58:43Z</sh:CreationDateAndTime>\r\n            </sh:DocumentIdentification>\r\n            <sh:BusinessScope>\r\n               <sh:Scope>\r\n                  <sh:Type>EDIcustomerNumber</sh:Type>\r\n                  <sh:InstanceIdentifier>90000050</sh:InstanceIdentifier>\r\n               </sh:Scope>\r\n               <sh:Scope>\r\n                  <sh:Type>fileType</sh:Type>\r\n                  <sh:InstanceIdentifier>IF</sh:InstanceIdentifier>\r\n               </sh:Scope>\r\n               <sh:Scope>\r\n                  <sh:Type>department</sh:Type>\r\n                  <sh:InstanceIdentifier>62</sh:InstanceIdentifier>\r\n               </sh:Scope>\r\n               <sh:Scope>\r\n                  <sh:Type>application</sh:Type>\r\n                  <sh:InstanceIdentifier>LOGI</sh:InstanceIdentifier>\r\n               </sh:Scope>\r\n            </sh:BusinessScope>\r\n         </sh:StandardBusinessDocumentHeader>\r\n         <transportInstruction>\r\n            <creationDateTime>2024-10-01T07:58:43Z</creationDateTime>\r\n            <documentStatusCode>ORIGINAL</documentStatusCode>\r\n            <documentActionCode>ADD</documentActionCode>\r\n            <transportInstructionIdentification>\r\n               <entityIdentification>12345_test/012934535</entityIdentification>\r\n            </transportInstructionIdentification>\r\n            <transportInstructionFunction>SHIPMENT</transportInstructionFunction>\r\n            <logisticServicesSeller/>\r\n            <logisticServicesBuyer>\r\n               <additionalPartyIdentification additionalPartyIdentificationTypeCode=\"searchname\">PAWE\u0141 ZAB\u0141OCKI ZAB\u0141OCKI I PARTNERZY</additionalPartyIdentification>\r\n            </logisticServicesBuyer>\r\n            <transportInstructionShipment>\r\n               <additionalShipmentIdentification additionalShipmentIdentificationTypeCode=\"refopd\">LC48</additionalShipmentIdentification>\r\n               <note languageCode=\"EN\" noteTypeCode=\"INF\"/>\r\n               <note languageCode=\"EN\" noteTypeCode=\"INF\">Fragile goods !</note>\r\n               <note languageCode=\"EN\" noteTypeCode=\"INF\">Towar niepi\u0119trowalny</note>\r\n               <note languageCode=\"EN\" noteTypeCode=\"INF\"/>\r\n               <note languageCode=\"EN\" noteTypeCode=\"INF\">Fragile goods !</note>\r\n               <note languageCode=\"EN\" noteTypeCode=\"INF\">Towar niepi\u0119trowalny</note>\r\n               <receiver>\r\n                  <additionalPartyIdentification additionalPartyIdentificationTypeCode=\"searchname\">3b045ae1-edec-485d-9</additionalPartyIdentification>\r\n                  <address>\r\n                     <city>\u00dcll\u0151</city>\r\n                     <countryCode>HU</countryCode>\r\n                     <name>AUCHAN MAGYARORSZ\u00c1G</name>\r\n                     <postalCode>2225</postalCode>\r\n                     <streetAddressOne>Zsar\u00f3ka \u00fat 8</streetAddressOne>\r\n                  </address>\r\n               </receiver>\r\n               <shipper>\r\n                  <additionalPartyIdentification additionalPartyIdentificationTypeCode=\"searchname\">ad11a7fc-0442-4b03-8</additionalPartyIdentification>\r\n                  <address>\r\n                     <city>WIRY</city>\r\n                     <countryCode>PL</countryCode>\r\n                     <name>PAWE\u0141 ZAB\u0141OCKI ZAB\u0141OCKI I PARTNERZY</name>\r\n                     <postalCode>62-051</postalCode>\r\n                     <streetAddressOne>KASZTANOWA 12</streetAddressOne>\r\n                  </address>\r\n               </shipper>\r\n               <shipTo>\r\n                  <additionalPartyIdentification additionalPartyIdentificationTypeCode=\"searchname\">3b045ae1-edec-485d-9</additionalPartyIdentification>\r\n                  <address>\r\n                     <city>\u00dcll\u0151</city>\r\n                     <countryCode>HU</countryCode>\r\n                     <name>AUCHAN MAGYARORSZ\u00c1G</name>\r\n                     <postalCode>2225</postalCode>\r\n                     <streetAddressOne>Zsar\u00f3ka \u00fat 8</streetAddressOne>\r\n                  </address>\r\n                  <contact>\r\n                     <contactTypeCode>BJ</contactTypeCode>\r\n                     <personName>John Doe</personName>\r\n                     <communicationChannel>\r\n                        <communicationChannelCode>EMAIL</communicationChannelCode>\r\n                        <communicationValue>john.doe@mail.com</communicationValue>\r\n                     </communicationChannel>\r\n                     <communicationChannel>\r\n                        <communicationChannelCode>TELEPHONE</communicationChannelCode>\r\n                        <communicationValue>+391234123490</communicationValue>\r\n                     </communicationChannel>\r\n                  </contact>\r\n               </shipTo>\r\n               <shipFrom>\r\n                  <additionalPartyIdentification additionalPartyIdentificationTypeCode=\"searchname\">ad11a7fc-0442-4b03-8</additionalPartyIdentification>\r\n                  <address>\r\n                     <city>WIRY</city>\r\n                     <countryCode>PL</countryCode>\r\n                     <name>PAWE\u0141 ZAB\u0141OCKI ZAB\u0141OCKI I PARTNERZY</name>\r\n                     <postalCode>62-051</postalCode>\r\n                     <streetAddressOne>KASZTANOWA 12</streetAddressOne>\r\n                  </address>\r\n               </shipFrom>\r\n               <transportInstructionTerms>\r\n                  <transportServiceCategoryType>30</transportServiceCategoryType>\r\n                  <logisticService>\r\n                     <logisticServiceRequirementCode logisticServiceTypeCode=\"parameters\">ForPlanning</logisticServiceRequirementCode>\r\n                  </logisticService>\r\n                  <logisticService>\r\n                     <logisticServiceRequirementCode logisticServiceTypeCode=\"productType\">PROD01</logisticServiceRequirementCode>\r\n                  </logisticService>\r\n                  <logisticService>\r\n                     <logisticServiceRequirementCode logisticServiceTypeCode=\"parameters\">ROD</logisticServiceRequirementCode>\r\n                  </logisticService>\r\n                  <logisticService>\r\n                     <logisticServiceRequirementCode logisticServiceTypeCode=\"parameters\">ROP</logisticServiceRequirementCode>\r\n                  </logisticService>\r\n               </transportInstructionTerms>\r\n               <plannedDespatch>\r\n                  <logisticEventPeriod>\r\n                     <beginDate>2024-10-27</beginDate>\r\n                     <beginTime>01:10:00</beginTime>\r\n                     <endDate>2024-10-27</endDate>\r\n                     <endTime>10:00:00</endTime>\r\n                  </logisticEventPeriod>\r\n               </plannedDespatch>\r\n               <transportReference>\r\n                  <entityIdentification>12345_test/012934535</entityIdentification>\r\n                  <transportReferenceTypeCode>customerRef</transportReferenceTypeCode>\r\n               </transportReference>\r\n               <transportInstructionShipmentItem>\r\n                  <lineItemNumber>1</lineItemNumber>\r\n                  <transportCargoCharacteristics>\r\n                     <cargoTypeCode>neam</cargoTypeCode>\r\n                     <cargoTypeDescription languageCode=\"PL\">Smycze</cargoTypeDescription>\r\n                     <totalGrossVolume measurementUnitCode=\"MTQ\">7.5</totalGrossVolume>\r\n                     <totalGrossWeight measurementUnitCode=\"KGM\">5.000</totalGrossWeight>\r\n                     <totalLoadingLength measurementUnitCode=\"PP\">2.8000000000000003</totalLoadingLength>\r\n                     <totalPackageQuantity measurementUnitCode=\"Euro pallet 120x80\">7</totalPackageQuantity>\r\n                     <totalItemQuantity measurementUnitCode=\"Euro pallet 120x80\">7</totalItemQuantity>\r\n                  </transportCargoCharacteristics>\r\n               </transportInstructionShipmentItem>\r\n            </transportInstructionShipment>\r\n         </transportInstruction>\r\n      </tms:transportInstructionMessage>\r\n   </soapenv:Body>\r\n</soapenv:Envelope>\r\n```\r\n\r\nthe error here is unexpected end of input block at row 161, col 15\r\n\r\nEX 2:\r\n\r\n```\r\n<?xml version=\"1.0\" ?>\r\n<soapenv:Envelope xmlns:soapenv=\"http://schemas.xmlsoap.org/soap/envelope/\" xmlns:tms=\"urn:CDM/tmsIntegrationService/\" xmlns:sh=\"http://www.unece.org/cefact/namespaces/StandardBusinessDocumentHeader\">\r\n   <soapenv:Header>\r\n      <wsse:Security xmlns:wsse=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-secext-1.0.xsd\">\r\n         <wsse:UsernameToken>\r\n            <wsse:Username>xxx_xxx</wsse:Username>\r\n            <wsse:Password>xxxxxxxxxxxxxxxxxxxx</wsse:Password>\r\n         </wsse:UsernameToken>\r\n      </wsse:Security>\r\n   </soapenv:Header>\r\n   <soapenv:Body>\r\n      <tms:transportInstructionMessage>\r\n         <sh:StandardBusinessDocumentHeader>\r\n            <sh:HeaderVersion>1</sh:HeaderVersion>\r\n            <sh:Sender>\r\n               <sh:Identifier>PAWE\u0141 ZAB\u0141OCKI ZAB\u0141OCKI I PARTNERZY</sh:Identifier>\r\n            </sh:Sender>\r\n            <sh:Receiver>\r\n               <sh:Identifier>Test Identifier</sh:Identifier>\r\n            </sh:Receiver>\r\n            <sh:DocumentIdentification>\r\n               <sh:Standard>GS1</sh:Standard>\r\n               <sh:TypeVersion>3.2</sh:TypeVersion>\r\n               <sh:InstanceIdentifier>100002</sh:InstanceIdentifier>\r\n               <sh:Type>Transport Instruction</sh:Type>\r\n               <sh:CreationDateAndTime>2024-10-01T08:06:49Z</sh:CreationDateAndTime>\r\n            </sh:DocumentIdentification>\r\n            <sh:BusinessScope>\r\n               <sh:Scope>\r\n                  <sh:Type>EDIcustomerNumber</sh:Type>\r\n                  <sh:InstanceIdentifier>90000050</sh:InstanceIdentifier>\r\n               </sh:Scope>\r\n               <sh:Scope>\r\n                  <sh:Type>fileType</sh:Type>\r\n                  <sh:InstanceIdentifier>IF</sh:InstanceIdentifier>\r\n               </sh:Scope>\r\n               <sh:Scope>\r\n                  <sh:Type>department</sh:Type>\r\n                  <sh:InstanceIdentifier>62</sh:InstanceIdentifier>\r\n               </sh:Scope>\r\n               <sh:Scope>\r\n                  <sh:Type>application</sh:Type>\r\n                  <sh:InstanceIdentifier>LOGI</sh:InstanceIdentifier>\r\n               </sh:Scope>\r\n            </sh:BusinessScope>\r\n         </sh:StandardBusinessDocumentHeader>\r\n         <transportInstruction>\r\n            <creationDateTime>2024-10-01T08:06:49Z</creationDateTime>\r\n            <documentStatusCode>ORIGINAL</documentStatusCode>\r\n            <documentActionCode>ADD</documentActionCode>\r\n            <transportInstructionIdentification>\r\n               <entityIdentification>GV-RD-0099703/1</entityIdentification>\r\n            </transportInstructionIdentification>\r\n            <transportInstructionFunction>SHIPMENT</transportInstructionFunction>\r\n            <logisticServicesSeller/>\r\n            <logisticServicesBuyer>\r\n               <additionalPartyIdentification additionalPartyIdentificationTypeCode=\"searchname\">PAWE\u0141 ZAB\u0141OCKI ZAB\u0141OCKI I PARTNERZY</additionalPartyIdentification>\r\n            </logisticServicesBuyer>\r\n            <transportInstructionShipment>\r\n               <additionalShipmentIdentification additionalShipmentIdentificationTypeCode=\"refopd\">LC49</additionalShipmentIdentification>\r\n               <note languageCode=\"EN\" noteTypeCode=\"INF\"/>\r\n               <note languageCode=\"EN\" noteTypeCode=\"INF\">Fragile goods !</note>\r\n               <note languageCode=\"EN\" noteTypeCode=\"INF\">Towar niepi\u0119trowalny</note>\r\n               <note languageCode=\"EN\" noteTypeCode=\"INF\"/>\r\n               <note languageCode=\"EN\" noteTypeCode=\"INF\">Fragile goods !</note>\r\n               <note languageCode=\"EN\" noteTypeCode=\"INF\">Towar niepi\u0119trowalny</note>\r\n               <receiver>\r\n                  <additionalPartyIdentification additionalPartyIdentificationTypeCode=\"searchname\">669ff966-c2ca-4745-8</additionalPartyIdentification>\r\n                  <address>\r\n                     <city>Hr\u00e1dek</city>\r\n                     <countryCode>CZ</countryCode>\r\n                     <name>Borgers Hradek</name>\r\n                     <postalCode>33842</postalCode>\r\n                     <streetAddressOne>Rokycanska ulice 223/II</streetAddressOne>\r\n                  </address>\r\n               </receiver>\r\n               <shipper>\r\n                  <additionalPartyIdentification additionalPartyIdentificationTypeCode=\"searchname\">ad11a7fc-0442-4b03-8</additionalPartyIdentification>\r\n                  <address>\r\n                     <city>WIRY</city>\r\n                     <countryCode>PL</countryCode>\r\n                     <name>PAWE\u0141 ZAB\u0141OCKI ZAB\u0141OCKI I PARTNERZY</name>\r\n                     <postalCode>62-051</postalCode>\r\n                     <streetAddressOne>KASZTANOWA 12</streetAddressOne>\r\n                  </address>\r\n               </shipper>\r\n               <shipTo>\r\n                  <additionalPartyIdentification additionalPartyIdentificationTypeCode=\"searchname\">669ff966-c2ca-4745-8</additionalPartyIdentification>\r\n                  <address>\r\n                     <city>Hr\u00e1dek</city>\r\n                     <countryCode>CZ</countryCode>\r\n                     <name>Borgers Hradek</name>\r\n                     <postalCode>33842</postalCode>\r\n                     <streetAddressOne>Rokycanska ulice 223/II</streetAddressOne>\r\n                  </address>\r\n                  <contact>\r\n                     <contactTypeCode>BJ</contactTypeCode>\r\n                     <personName>John Doe</personName>\r\n                     <communicationChannel>\r\n                        <communicationChannelCode>EMAIL</communicationChannelCode>\r\n                        <communicationValue>john.doe@mail.com</communicationValue>\r\n                     </communicationChannel>\r\n                     <communicationChannel>\r\n                        <communicationChannelCode>TELEPHONE</communicationChannelCode>\r\n                        <communicationValue>+391231212340</communicationValue>\r\n                     </communicationChannel>\r\n                  </contact>\r\n               </shipTo>\r\n               <shipFrom>\r\n                  <additionalPartyIdentification additionalPartyIdentificationTypeCode=\"searchname\">ad11a7fc-0442-4b03-8</additionalPartyIdentification>\r\n                  <address>\r\n                     <city>WIRY</city>\r\n                     <countryCode>PL</countryCode>\r\n                     <name>PAWE\u0141 ZAB\u0141OCKI ZAB\u0141OCKI I PARTNERZY</name>\r\n                     <postalCode>62-051</postalCode>\r\n                     <streetAddressOne>KASZTANOWA 12</streetAddressOne>\r\n                  </address>\r\n               </shipFrom>\r\n               <transportInstructionTerms>\r\n                  <transportServiceCategoryType>30</transportServiceCategoryType>\r\n                  <logisticService>\r\n                     <logisticServiceRequirementCode logisticServiceTypeCode=\"parameters\">ForPlanning</logisticServiceRequirementCode>\r\n                  </logisticService>\r\n                  <logisticService>\r\n                     <logisticServiceRequirementCode logisticServiceTypeCode=\"productType\">PROD01</logisticServiceRequirementCode>\r\n                  </logisticService>\r\n                  <logisticService>\r\n                     <logisticServiceRequirementCode logisticServiceTypeCode=\"parameters\">ROD</logisticServiceRequirementCode>\r\n                  </logisticService>\r\n                  <logisticService>\r\n                     <logisticServiceRequirementCode logisticServiceTypeCode=\"parameters\">ROP</logisticServiceRequirementCode>\r\n                  </logisticService>\r\n               </transportInstructionTerms>\r\n               <plannedDespatch>\r\n                  <logisticEventPeriod>\r\n                     <beginDate>2024-10-10</beginDate>\r\n                     <beginTime>08:00:00</beginTime>\r\n                     <endDate>2024-10-10</endDate>\r\n                     <endTime>22:00:00</endTime>\r\n                  </logisticEventPeriod>\r\n               </plannedDespatch>\r\n               <transportReference>\r\n                  <entityIdentification>GV-RD-0099703/1</entityIdentification>\r\n                  <transportReferenceTypeCode>customerRef</transportReferenceTypeCode>\r\n               </transportReference>\r\n               <transportInstructionShipmentItem>\r\n                  <lineItemNumber>1</lineItemNumber>\r\n                  <transportCargoCharacteristics>\r\n                     <cargoTypeCode>neam</cargoTypeCode>\r\n                     <cargoTypeDescription languageCode=\"PL\">Smycze</cargoTypeDescription>\r\n                     <totalGrossVolume measurementUnitCode=\"MTQ\">0.00</totalGrossVolume>\r\n                     <totalGrossWeight measurementUnitCode=\"KGM\">24.500</totalGrossWeight>\r\n                     <totalLoadingLength measurementUnitCode=\"PP\">2.8000000000000003</totalLoadingLength>\r\n                     <totalPackageQuantity measurementUnitCode=\"Euro pallet 120x80\">7</totalPackageQuantity>\r\n                     <totalItemQuantity measurementUnitCode=\"Euro pallet 120x80\">7</totalItemQuantity>\r\n                  </transportCargoCharacteristics>\r\n               </transportInstructionShipmentItem>\r\n            </transportInstructionShipment>\r\n         </transportInstruction>\r\n      </tms:transportInstructionMessage>\r\n   </soapenv:Body>\r\n</soapenv:Envelope>\r\n```\r\n\r\nhere the row is the same but the column is different\r\n",
    "labels": [],
    "state": "closed",
    "repo": "requests/requests"
  },
  {
    "id": 6815,
    "title": "Handle PermissionError when importing adapter.py",
    "body": "In Windows, if the running process has restricted permissions the process may not have permission to read the file \"C:\\\\Users\\\\User\\\\Documents\\\\syskeylog.txt\". Sounds silly, but this error can propagate through dependencies and prevent them from complete importing, even if the functionality you expect from them do not depend on this project.\r\n\r\n\r\n\r\n## Expected Result\r\n\r\nCan import adapter.py\r\n\r\n## Actual Result\r\n```\r\n    from pypac.parser import PACFile\r\n  File \"C:\\Users\\User\\python_venvs\\companion_app312\\Lib\\site-packages\\pypac\\__init__.py\", line 20, in <module>\r\n    from pypac.api import (\r\n  File \"C:\\Users\\User\\python_venvs\\companion_app312\\Lib\\site-packages\\pypac\\api.py\", line 7, in <module>\r\n    import requests\r\n  File \"C:\\Users\\User\\python_venvs\\companion_app312\\Lib\\site-packages\\requests\\__init__.py\", line 164, in <module>\r\n    from .api import delete, get, head, options, patch, post, put, request\r\n  File \"C:\\Users\\User\\python_venvs\\companion_app312\\Lib\\site-packages\\requests\\api.py\", line 11, in <module>\r\n    from . import sessions\r\n  File \"C:\\Users\\User\\python_venvs\\companion_app312\\Lib\\site-packages\\requests\\sessions.py\", line 15, in <module>\r\n    from .adapters import HTTPAdapter\r\n  File \"C:\\Users\\User\\python_venvs\\companion_app312\\Lib\\site-packages\\requests\\adapters.py\", line 80, in <module>\r\n    _preloaded_ssl_context = create_urllib3_context()\r\n                             ^^^^^^^^^^^^^^^^^^^^^^^^\r\n  File \"C:\\Users\\User\\python_venvs\\companion_app312\\Lib\\site-packages\\urllib3\\util\\ssl_.py\", line 349, in create_urllib3_context\r\n    context.keylog_filename = sslkeylogfile\r\n    ^^^^^^^^^^^^^^^^^^^^^^^\r\nPermissionError: [Errno 13] Permission denied: 'C:\\\\Users\\\\User\\\\Documents\\\\syskeylog.txt'\r\n```\r\n\r\n## Reproduction Steps\r\n\r\n\r\nRun the following code in Windows. You gotta remove a line and un-indent a block. See comment within the code.\r\n\r\n```\r\nimport _winapi\r\nimport asyncio\r\nimport ctypes\r\nimport msvcrt\r\nimport os\r\nimport socket\r\nimport subprocess\r\nimport sys\r\nimport time\r\nimport traceback\r\nimport winreg\r\nfrom ctypes import wintypes\r\nfrom multiprocessing import spawn\r\nfrom subprocess import Popen\r\n\r\nimport win32api\r\nimport win32con\r\nimport win32security\r\nfrom _ctypes import byref, sizeof\r\n\r\n\r\ndef check_privilege():\r\n    # Get the current process token\r\n    token = win32security.OpenProcessToken(win32api.GetCurrentProcess(), win32con.TOKEN_QUERY)\r\n\r\n    # Retrieve the privileges\r\n    privileges = win32security.GetTokenInformation(token, win32security.TokenPrivileges)\r\n    elevation = win32security.GetTokenInformation(token, win32security.TokenElevation)\r\n    print(elevation)\r\n    # Check if the required privilege is present\r\n    for privilege in privileges:\r\n        print(f\"{win32security.LookupPrivilegeName(None, privilege[0])} - {privilege[1]}\", file=sys.stderr)\r\n    return False\r\n\r\n\r\ndef check_groups():\r\n    token = win32security.OpenProcessToken(win32api.GetCurrentProcess(), win32con.TOKEN_QUERY)\r\n\r\n    groups = win32security.GetTokenInformation(token, win32security.TokenGroups)\r\n\r\n    for group, enabled in groups:\r\n        name = win32security.LookupAccountSid(None, group)\r\n        print(f\"{group} - {name} - {hex(enabled)}\", file=sys.stderr)\r\n\r\n\r\ndef _get_token():\r\n    # h_token = win32security.LogonUser(\r\n    #     \"nopriv\",\r\n    #     \"VAN-917843-PC3\",\r\n    #     \"Stillcreekdr123!\",\r\n    #     win32con.LOGON32_LOGON_INTERACTIVE,\r\n    #     win32con.LOGON32_PROVIDER_DEFAULT\r\n    # )\r\n\r\n    # gid = _get_fnbi_group()\r\n    # _add_fnbi_group_user()\r\n\r\n    system_token = win32security.OpenProcessToken(win32api.GetCurrentProcess(),\r\n                                                  win32con.TOKEN_DUPLICATE\r\n                                                  | win32con.TOKEN_ADJUST_DEFAULT\r\n                                                  | win32con.TOKEN_ADJUST_PRIVILEGES\r\n                                                  | win32con.TOKEN_QUERY\r\n                                                  | win32con.TOKEN_ASSIGN_PRIMARY\r\n                                                  | win32con.TOKEN_ADJUST_GROUPS)\r\n    low_integrity_SID = \"S-1-16-4096\"\r\n    # https://learn.microsoft.com/en-ca/windows/win32/api/securitybaseapi/nf-securitybaseapi-createrestrictedtoken\r\n    # BOOL CreateRestrictedToken(\r\n    #   [in]           HANDLE               ExistingTokenHandle,\r\n    #   [in]           DWORD                Flags,\r\n    #   [in]           DWORD                DisableSidCount,\r\n    #   [in, optional] PSID_AND_ATTRIBUTES  SidsToDisable,\r\n    #   [in]           DWORD                DeletePrivilegeCount,\r\n    #   [in, optional] PLUID_AND_ATTRIBUTES PrivilegesToDelete,\r\n    #   [in]           DWORD                RestrictedSidCount,\r\n    #   [in, optional] PSID_AND_ATTRIBUTES  SidsToRestrict,\r\n    #   [out]          PHANDLE              NewTokenHandle\r\n    # );\r\n\r\n    old_groups = win32security.GetTokenInformation(system_token, win32security.TokenGroups)\r\n    disabled_sids = []\r\n    restricted_sids = []\r\n    enabled_masks = {\r\n        \"S-1-1-0\", # everyone\r\n        \"S-1-5-32-545\", # Users - needed for dev only?\r\n        \"S-1-5-5\", # logon session - dev only\r\n    }\r\n    restricted_masks = {\r\n\r\n    }\r\n\r\n    def mask_match(entry: str, mask_set):\r\n        for m in mask_set:\r\n            if entry.startswith(m):\r\n                return True\r\n        return False\r\n\r\n    for g, state in old_groups:\r\n        sid_str = str(g).split(\":\")[1]\r\n\r\n        if mask_match(sid_str, restricted_masks):\r\n            restricted_sids.append((g, 0))\r\n            continue\r\n\r\n        if mask_match(sid_str, enabled_masks):\r\n            continue\r\n\r\n        disabled_sids.append((g, 0))\r\n\r\n    restricted_token = win32security.CreateRestrictedToken(\r\n        system_token,\r\n        win32security.DISABLE_MAX_PRIVILEGE,  # flags\r\n        # None,\r\n        disabled_sids,  # denied SIDS\r\n        None,  # privs to delete\r\n        restricted_sids  # restricted SIDS\r\n    )\r\n\r\n    til = (win32security.CreateWellKnownSid(win32security.WinLowLabelSid), win32security.SE_GROUP_INTEGRITY)\r\n    win32security.SetTokenInformation(restricted_token, win32security.TokenIntegrityLevel, til)\r\n\r\n    return restricted_token\r\n\r\n\r\nclass STARTUPINFO(ctypes.Structure):\r\n    _fields_ = [\r\n        (\"cb\", wintypes.DWORD),  # Size of the structure\r\n        (\"lpReserved\", wintypes.LPWSTR),  # Reserved; must be NULL\r\n        (\"lpDesktop\", wintypes.LPWSTR),  # Name of the desktop\r\n        (\"lpTitle\", wintypes.LPWSTR),  # Title of the window\r\n        (\"dwX\", wintypes.DWORD),  # X position\r\n        (\"dwY\", wintypes.DWORD),  # Y position\r\n        (\"dwXSize\", wintypes.DWORD),  # Width of the window\r\n        (\"dwYSize\", wintypes.DWORD),  # Height of the window\r\n        (\"dwXCountChars\", wintypes.DWORD),  # Height of the window\r\n        (\"dwYCountChars\", wintypes.DWORD),  # Height of the window\r\n        (\"dwFillAttribute\", wintypes.DWORD),  # Height of the window\r\n        (\"dwFlags\", wintypes.DWORD),  # Flags\r\n        (\"wShowWindow\", wintypes.WORD),  # Show window command\r\n        (\"cbReserved2\", wintypes.WORD),  # Size of the reserved area\r\n        (\"lpReserved2\", wintypes.LPBYTE),  # Pointer to the reserved area\r\n        (\"hStdInput\", wintypes.HANDLE),  # Handle to standard input\r\n        (\"hStdOutput\", wintypes.HANDLE),  # Handle to standard output\r\n        (\"hStdError\", wintypes.HANDLE)  # Handle to standard error\r\n    ]\r\n\r\n\r\nclass STARTUPINFOEX(ctypes.Structure):\r\n    _fields_ = [\r\n        (\"StartupInfo\", STARTUPINFO),\r\n        (\"lpAttributeList\", wintypes.LPVOID)\r\n    ]\r\n\r\n\r\n# Define PROCESS_INFORMATION structure\r\nclass PROCESS_INFORMATION(ctypes.Structure):\r\n    _fields_ = [\r\n        (\"hProcess\", wintypes.HANDLE),\r\n        (\"hThread\", wintypes.HANDLE),\r\n        (\"dwProcessId\", wintypes.DWORD),\r\n        (\"dwThreadId\", wintypes.DWORD)\r\n    ]\r\n\r\n\r\n# Load the function\r\nkernel32 = ctypes.WinDLL('kernel32', use_last_error=True)\r\nadvapi32 = ctypes.WinDLL('advapi32', use_last_error=True)\r\nlibc = ctypes.CDLL(\"msvcrt.dll\")\r\n\r\n# Define SetHandleInformation function\r\nSetHandleInformation = kernel32.SetHandleInformation\r\nSetHandleInformation.argtypes = [\r\n    ctypes.wintypes.HANDLE,  # hObject\r\n    ctypes.wintypes.DWORD,  # dwMask\r\n    ctypes.wintypes.DWORD  # dwFlags\r\n]\r\nSetHandleInformation.restype = ctypes.wintypes.BOOL\r\n\r\nCreateProcessW = kernel32.CreateProcessW\r\nCreateProcessAsUser = advapi32.CreateProcessAsUserW\r\nCREATE_UNICODE_ENVIRONMENT = 0x00000400\r\nPROC_THREAD_ATTRIBUTE_LIST = 0x00020000\r\nPROC_THREAD_ATTRIBUTE_HANDLE_LIST = 0x00020004\r\nEXTENDED_STARTUPINFO_PRESENT = 0x00080000\r\nHANDLE_FLAG_INHERIT = 0x00000001\r\nHANDLE_FLAG_PROTECT_FROM_CLOSE = 0x00000002\r\n\r\n\r\ndef get_last_error_message():\r\n    error_code = ctypes.get_last_error()\r\n    if error_code == 0:\r\n        return \"No error.\"\r\n\r\n    message_buffer = ctypes.create_string_buffer(256)\r\n    message_length = kernel32.FormatMessageA(\r\n        0x00000001 | 0x00001000,  # FORMAT_MESSAGE_FROM_SYSTEM | FORMAT_MESSAGE_ALLOCATE_BUFFER\r\n        None,\r\n        error_code,\r\n        0,\r\n        byref(message_buffer),\r\n        ctypes.sizeof(message_buffer),\r\n        None\r\n    )\r\n\r\n    if message_length == 0:\r\n        return f\"Unknown error code: {error_code}\"\r\n    msg = message_buffer.value.decode('ansi').replace('\\r', '').replace('\\n', '')\r\n    return msg\r\n\r\n\r\nfoo = None\r\n\r\n\r\n# Function to get Windows handle from file descriptor\r\ndef get_windows_handle(file):\r\n    # Get the file descriptor\r\n    fd = file.fileno()\r\n\r\n    # Use _get_osfhandle to get the Windows handle\r\n    handle = ctypes.windll.kernel32._get_osfhandle(fd)\r\n\r\n    if handle == -1:\r\n        raise ValueError(\"Could not get the Windows handle.\")\r\n\r\n    return handle\r\n\r\n\r\ndef make_handle_inheritable(handle):\r\n    if not SetHandleInformation(handle, HANDLE_FLAG_INHERIT, HANDLE_FLAG_INHERIT):\r\n        raise ctypes.WinError(ctypes.get_last_error())\r\n\r\n\r\ndef writer_main():\r\n    def CreateProcess(cmd, cmdline, proc_attr, thread_attr, inherit_handles, creation_flags, current_directory,\r\n                      environment, startup_info):\r\n        # change_privilege(win32con.SE_PRIVILEGE_ENABLED)\r\n        # check_privilege()\r\n\r\n        token = _get_token()\r\n        # CreateProcessAsUser\r\n        #   0 [in, optional]      HANDLE                hToken,\r\n        #   1 [in, optional]      LPCSTR                lpApplicationName,\r\n        #   2 [in, out, optional] LPSTR                 lpCommandLine,\r\n        #   3 [in, optional]      LPSECURITY_ATTRIBUTES lpProcessAttributes,\r\n        #   4 [in, optional]      LPSECURITY_ATTRIBUTES lpThreadAttributes,\r\n        #   5 [in]                BOOL                  bInheritHandles,\r\n        #   6 [in]                DWORD                 dwCreationFlags,\r\n        #   7 [in, optional]      LPVOID                lpEnvironment,\r\n        #   8 [in, optional]      LPCSTR                lpCurrentDirectory,\r\n        #   9 [in]                LPSTARTUPINFOA        lpStartupInfo,\r\n\r\n        # CreateProcess\r\n        #   0 [in, optional]      LPCSTR                lpApplicationName,\r\n        #   1 [in, out, optional] LPSTR                 lpCommandLine,\r\n        #   2 [in, optional]      LPSECURITY_ATTRIBUTES lpProcessAttributes,\r\n        #   3 [in, optional]      LPSECURITY_ATTRIBUTES lpThreadAttributes,\r\n        #   4 [in]                BOOL                  bInheritHandles,\r\n        #   5 [in]                DWORD                 dwCreationFlags,\r\n        #   6 [in, optional]      LPVOID                lpEnvironment,\r\n        #   7 [in, optional]      LPCSTR                lpCurrentDirectory,\r\n        #   8 [in]                LPSTARTUPINFOA        lpStartupInfo,\r\n        six = STARTUPINFOEX()\r\n        si = six.StartupInfo\r\n        si.cb = ctypes.sizeof(STARTUPINFOEX)\r\n        attribute_list_size = wintypes.DWORD()\r\n\r\n        kernel32.InitializeProcThreadAttributeList(None, 1, 0, byref(attribute_list_size))\r\n\r\n        buffer = (wintypes.BYTE * (attribute_list_size.value + 10))()\r\n        six.lpAttributeList = ctypes.cast(buffer, wintypes.LPVOID)\r\n        if not six.lpAttributeList:\r\n            print(f\"HeapAlloc failed with error: {get_last_error_message()}\")\r\n            raise RuntimeError()\r\n\r\n        if not kernel32.InitializeProcThreadAttributeList(\r\n                byref(buffer),\r\n                1,\r\n                0,\r\n                byref(attribute_list_size)\r\n        ):\r\n            print(f\"InitializeProcThreadAttributeList failed with error: {get_last_error_message()}\")\r\n            raise RuntimeError()\r\n        if startup_info is not None:\r\n            si.dwFlags |= win32con.STARTF_USESTDHANDLES  # Enable standard handle redirection\r\n            si.hStdOutput = getattr(startup_info, \"hStdOutput\")  # Redirect standard output\r\n            si.hStdInput = getattr(startup_info, \"hStdInput\")  # Redirect standard error\r\n            si.hStdError = getattr(startup_info, \"hStdError\")  # Redirect standard error\r\n            handle_list = [wintypes.HANDLE(si.hStdOutput), wintypes.HANDLE(si.hStdInput), wintypes.HANDLE(si.hStdError)]\r\n            handle_count = len(handle_list)\r\n            handles_array = (wintypes.HANDLE * handle_count)(*handle_list)  # Create an array of handles\r\n            ctypes.windll.kernel32.UpdateProcThreadAttribute(\r\n                buffer,\r\n                0,\r\n                PROC_THREAD_ATTRIBUTE_HANDLE_LIST,\r\n                handles_array,\r\n                handle_count * sizeof(wintypes.HANDLE),\r\n                None,\r\n                None\r\n            )\r\n\r\n        pi = PROCESS_INFORMATION()\r\n        success = advapi32.CreateProcessAsUserW(\r\n            token.handle,\r\n            python_exe, cmdline, proc_attr, thread_attr, inherit_handles,\r\n            creation_flags | CREATE_UNICODE_ENVIRONMENT,\r\n            environment, current_directory, byref(six), byref(pi)\r\n        )\r\n\r\n        # return TemporaryLibPatch.execute_unpatched(CreateProcess,\r\n        #     python_exe, cmdline, proc_attr, thread_attr, inherit_handles,\r\n        #     creation_flags,\r\n        #     environment, current_directory, startup_info\r\n        # )\r\n\r\n        if not success:\r\n            print(f\"CreateProcessAsUser failed with error: {get_last_error_message()}\")\r\n            raise RuntimeError()\r\n\r\n        return pi.hProcess, pi.hThread, pi.dwProcessId, pi.dwThreadId,\r\n\r\n    file = open(__file__, 'r')\r\n    handle = msvcrt.get_osfhandle(file.fileno())\r\n    make_handle_inheritable(handle)\r\n    \r\n    _winapi.CreateProcess = CreateProcess\r\n    # You can remove the context manager line below. It just wraps around the line above. The Github editor doesn't let me easily remove the indentation of the block....\r\n    with TemporaryLibPatch(_winapi, CreateProcess): \r\n        def _path_eq(p1, p2):\r\n            return p1 == p2 or os.path.normcase(p1) == os.path.normcase(p2)\r\n\r\n        WINENV = _path_eq(sys.executable, sys._base_executable)\r\n\r\n        python_exe = spawn.get_executable()\r\n        set_pylauncher = False\r\n\r\n        # FROM multiprocessing module:\r\n        # # bpo-35797: When running in a venv, we bypass the redirect\r\n\r\n        if WINENV and _path_eq(python_exe, sys.executable):\r\n            python_exe = sys._base_executable\r\n            set_pylauncher = True\r\n            os.environ[\"__PYVENV_LAUNCHER__\"] = sys.executable\r\n\r\n        proc = Popen([\r\n            python_exe,\r\n            __file__,\r\n            \"--read\",\r\n        ], stdout=subprocess.PIPE,\r\n            stdin=subprocess.PIPE,\r\n            shell=False,\r\n            close_fds=False\r\n        )\r\n\r\n        if set_pylauncher:\r\n            os.unsetenv(\"__PYVENV_LAUNCHER__\")     \r\n        proc.wait()\r\n\r\n\r\ndef reader_main():\r\n     import requests\r\n\r\n\r\nif __name__ == '__main__':\r\n    if len(sys.argv) > 1 and sys.argv[1] == \"--read\":\r\n        reader_main()\r\n    else:\r\n        writer_main()\r\n\r\n```\r\n\r\n## System Information\r\n\r\n    $ python -m requests.help\r\n\r\n```json\r\n{\r\n  \"chardet\": {\r\n    \"version\": null\r\n  },\r\n  \"charset_normalizer\": {\r\n    \"version\": \"3.3.2\"\r\n  },\r\n  \"cryptography\": {\r\n    \"version\": \"\"\r\n  },\r\n  \"idna\": {\r\n    \"version\": \"3.8\"\r\n  },\r\n  \"implementation\": {\r\n    \"name\": \"CPython\",\r\n    \"version\": \"3.12.5\"\r\n  },\r\n  \"platform\": {\r\n    \"release\": \"10\",\r\n    \"system\": \"Windows\"\r\n  },\r\n  \"pyOpenSSL\": {\r\n    \"openssl_version\": \"\",\r\n    \"version\": null\r\n  },\r\n  \"requests\": {\r\n    \"version\": \"2.32.3\"\r\n  },\r\n  \"system_ssl\": {\r\n    \"version\": \"300000d0\"\r\n  },\r\n  \"urllib3\": {\r\n    \"version\": \"2.2.2\"\r\n  },\r\n  \"using_charset_normalizer\": true,\r\n  \"using_pyopenssl\": false\r\n}\r\n\r\n```\r\n\r\n<!-- This command is only available on Requests v2.16.4 and greater. Otherwise,\r\nplease provide some basic information about your system (Python version,\r\noperating system, &c). -->\r\n",
    "labels": [],
    "state": "closed",
    "repo": "requests/requests"
  },
  {
    "id": 7055,
    "title": "Could not find a suitable TLS CA certificate bundle, invalid path: /agents/python/common/certifi/cacert.pem",
    "body": "```\n2025-10-21T10:12:14.3082809Z ERROR:    Exception in ASGI application\n2025-10-21T10:12:14.3083028Z Traceback (most recent call last):\n2025-10-21T10:12:14.3083065Z   File \"/tmp/8de1086b7810c73/antenv/lib/python3.11/site-packages/uvicorn/protocols/http/httptools_impl.py\", line 409, in run_asgi\n2025-10-21T10:12:14.3083091Z     result = await app(  # type: ignore[func-returns-value]\n2025-10-21T10:12:14.3083115Z              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n2025-10-21T10:12:14.3083142Z   File \"/tmp/8de1086b7810c73/antenv/lib/python3.11/site-packages/uvicorn/middleware/proxy_headers.py\", line 60, in __call__\n2025-10-21T10:12:14.3083165Z     return await self.app(scope, receive, send)\n2025-10-21T10:12:14.3083188Z            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n2025-10-21T10:12:14.3083214Z   File \"/tmp/8de1086b7810c73/antenv/lib/python3.11/site-packages/fastapi/applications.py\", line 1133, in __call__\n2025-10-21T10:12:14.3083239Z     await super().__call__(scope, receive, send)\n2025-10-21T10:12:14.3083277Z   File \"/tmp/8de1086b7810c73/antenv/lib/python3.11/site-packages/starlette/applications.py\", line 113, in __call__\n2025-10-21T10:12:14.3083301Z     await self.middleware_stack(scope, receive, send)\n2025-10-21T10:12:14.3083329Z   File \"/tmp/8de1086b7810c73/antenv/lib/python3.11/site-packages/starlette/middleware/errors.py\", line 186, in __call__\n2025-10-21T10:12:14.3083351Z     raise exc\n2025-10-21T10:12:14.3083377Z   File \"/tmp/8de1086b7810c73/antenv/lib/python3.11/site-packages/starlette/middleware/errors.py\", line 164, in __call__\n2025-10-21T10:12:14.30834Z     await self.app(scope, receive, _send)\n2025-10-21T10:12:14.3083426Z   File \"/agents/python/common/opentelemetry/instrumentation/asgi/__init__.py\", line 768, in __call__\n2025-10-21T10:12:14.3083451Z     await self.app(scope, otel_receive, otel_send)\n2025-10-21T10:12:14.3083478Z   File \"/tmp/8de1086b7810c73/antenv/lib/python3.11/site-packages/starlette/middleware/errors.py\", line 186, in __call__\n2025-10-21T10:12:14.3083499Z     raise exc\n2025-10-21T10:12:14.3083526Z   File \"/tmp/8de1086b7810c73/antenv/lib/python3.11/site-packages/starlette/middleware/errors.py\", line 164, in __call__\n2025-10-21T10:12:14.3083565Z     await self.app(scope, receive, _send)\n2025-10-21T10:12:14.3083594Z   File \"/tmp/8de1086b7810c73/antenv/lib/python3.11/site-packages/starlette/middleware/cors.py\", line 85, in __call__\n2025-10-21T10:12:14.3083622Z     await self.app(scope, receive, send)\n2025-10-21T10:12:14.3083651Z   File \"/tmp/8de1086b7810c73/antenv/lib/python3.11/site-packages/starlette/middleware/exceptions.py\", line 63, in __call__\n2025-10-21T10:12:14.3083676Z     await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n2025-10-21T10:12:14.3083705Z   File \"/tmp/8de1086b7810c73/antenv/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n2025-10-21T10:12:14.3083726Z     raise exc\n2025-10-21T10:12:14.3083751Z   File \"/tmp/8de1086b7810c73/antenv/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n2025-10-21T10:12:14.3083774Z     await app(scope, receive, sender)\n2025-10-21T10:12:14.30838Z   File \"/tmp/8de1086b7810c73/antenv/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py\", line 18, in __call__\n2025-10-21T10:12:14.3083834Z     await self.app(scope, receive, send)\n2025-10-21T10:12:14.3083861Z   File \"/tmp/8de1086b7810c73/antenv/lib/python3.11/site-packages/starlette/routing.py\", line 716, in __call__\n2025-10-21T10:12:14.3083884Z     await self.middleware_stack(scope, receive, send)\n2025-10-21T10:12:14.308391Z   File \"/tmp/8de1086b7810c73/antenv/lib/python3.11/site-packages/starlette/routing.py\", line 736, in app\n2025-10-21T10:12:14.3083932Z     await route.handle(scope, receive, send)\n2025-10-21T10:12:14.3083957Z   File \"/tmp/8de1086b7810c73/antenv/lib/python3.11/site-packages/starlette/routing.py\", line 290, in handle\n2025-10-21T10:12:14.308398Z     await self.app(scope, receive, send)\n2025-10-21T10:12:14.3084004Z   File \"/tmp/8de1086b7810c73/antenv/lib/python3.11/site-packages/fastapi/routing.py\", line 123, in app\n2025-10-21T10:12:14.3084029Z     await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n2025-10-21T10:12:14.3084055Z   File \"/tmp/8de1086b7810c73/antenv/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n2025-10-21T10:12:14.3084089Z     raise exc\n2025-10-21T10:12:14.3084116Z   File \"/tmp/8de1086b7810c73/antenv/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n2025-10-21T10:12:14.308414Z     await app(scope, receive, sender)\n2025-10-21T10:12:14.3084166Z   File \"/tmp/8de1086b7810c73/antenv/lib/python3.11/site-packages/fastapi/routing.py\", line 109, in app\n2025-10-21T10:12:14.3084189Z     response = await f(request)\n2025-10-21T10:12:14.3084212Z                ^^^^^^^^^^^^^^^^\n2025-10-21T10:12:14.3084239Z   File \"/tmp/8de1086b7810c73/antenv/lib/python3.11/site-packages/fastapi/routing.py\", line 379, in app\n2025-10-21T10:12:14.3084262Z     solved_result = await solve_dependencies(\n2025-10-21T10:12:14.3084285Z                     ^^^^^^^^^^^^^^^^^^^^^^^^^\n2025-10-21T10:12:14.3084312Z   File \"/tmp/8de1086b7810c73/antenv/lib/python3.11/site-packages/fastapi/dependencies/utils.py\", line 651, in solve_dependencies\n2025-10-21T10:12:14.3084335Z     solved_result = await solve_dependencies(\n2025-10-21T10:12:14.3084369Z                     ^^^^^^^^^^^^^^^^^^^^^^^^^\n2025-10-21T10:12:14.3084397Z   File \"/tmp/8de1086b7810c73/antenv/lib/python3.11/site-packages/fastapi/dependencies/utils.py\", line 675, in solve_dependencies\n2025-10-21T10:12:14.3084635Z     solved = await run_in_threadpool(call, **solved_result.values)\n2025-10-21T10:12:14.3084661Z              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n2025-10-21T10:12:14.308469Z   File \"/tmp/8de1086b7810c73/antenv/lib/python3.11/site-packages/starlette/concurrency.py\", line 38, in run_in_threadpool\n2025-10-21T10:12:14.3084714Z     return await anyio.to_thread.run_sync(func)\n2025-10-21T10:12:14.3084737Z            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n2025-10-21T10:12:14.3084765Z   File \"/tmp/8de1086b7810c73/antenv/lib/python3.11/site-packages/anyio/to_thread.py\", line 56, in run_sync\n2025-10-21T10:12:14.308479Z     return await get_async_backend().run_sync_in_worker_thread(\n2025-10-21T10:12:14.3084826Z            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n2025-10-21T10:12:14.3084853Z   File \"/tmp/8de1086b7810c73/antenv/lib/python3.11/site-packages/anyio/_backends/_asyncio.py\", line 2485, in run_sync_in_worker_thread\n2025-10-21T10:12:14.3084876Z     return await future\n2025-10-21T10:12:14.3084898Z            ^^^^^^^^^^^^\n2025-10-21T10:12:14.3084925Z   File \"/tmp/8de1086b7810c73/antenv/lib/python3.11/site-packages/anyio/_backends/_asyncio.py\", line 976, in run\n2025-10-21T10:12:14.3084947Z     result = context.run(func, *args)\n2025-10-21T10:12:14.308497Z              ^^^^^^^^^^^^^^^^^^^^^^^^\n2025-10-21T10:12:14.3084994Z   File \"/tmp/8de1086b7810c73/main.py\", line 159, in get_session_id\n2025-10-21T10:12:14.3085018Z     log_function(f\"in get_session_id\")\n2025-10-21T10:12:14.3085043Z   File \"/tmp/8de1086b7810c73/logging_utility.py\", line 27, in log_function\n2025-10-21T10:12:14.3085067Z     existing = blob_client.download_blob().readall()\n2025-10-21T10:12:14.3085105Z                ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n2025-10-21T10:12:14.3085132Z   File \"/agents/python/common/azure/core/tracing/decorator.py\", line 138, in wrapper_use_tracer\n2025-10-21T10:12:14.3085159Z   File \"/tmp/8de1086b7810c73/antenv/lib/python3.11/site-packages/azure/storage/blob/_blob_client.py\", line 779, in download_blob\n2025-10-21T10:12:14.3085184Z     return StorageStreamDownloader(**options)\n2025-10-21T10:12:14.3085206Z            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n2025-10-21T10:12:14.3085233Z   File \"/tmp/8de1086b7810c73/antenv/lib/python3.11/site-packages/azure/storage/blob/_download.py\", line 403, in __init__\n2025-10-21T10:12:14.3085256Z     self._response = self._initial_request()\n2025-10-21T10:12:14.308528Z                      ^^^^^^^^^^^^^^^^^^^^^^^\n2025-10-21T10:12:14.3085307Z   File \"/tmp/8de1086b7810c73/antenv/lib/python3.11/site-packages/azure/storage/blob/_download.py\", line 456, in _initial_request\n2025-10-21T10:12:14.3085332Z     location_mode, response = cast(Tuple[Optional[str], Any], self._clients.blob.download(\n2025-10-21T10:12:14.3085369Z                                                               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n2025-10-21T10:12:14.3085395Z   File \"/agents/python/common/azure/core/tracing/decorator.py\", line 138, in wrapper_use_tracer\n2025-10-21T10:12:14.3085423Z   File \"/tmp/8de1086b7810c73/antenv/lib/python3.11/site-packages/azure/storage/blob/_generated/operations/_blob_operations.py\", line 1639, in download\n2025-10-21T10:12:14.308545Z     pipeline_response: PipelineResponse = self._client._pipeline.run(  # pylint: disable=protected-access\n2025-10-21T10:12:14.3085478Z                                           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n2025-10-21T10:12:14.3085503Z   File \"/agents/python/common/azure/core/pipeline/_base.py\", line 242, in run\n2025-10-21T10:12:14.3085529Z   File \"/agents/python/common/azure/core/pipeline/_base.py\", line 98, in send\n2025-10-21T10:12:14.3085554Z   File \"/agents/python/common/azure/core/pipeline/_base.py\", line 98, in send\n2025-10-21T10:12:14.308558Z   File \"/agents/python/common/azure/core/pipeline/_base.py\", line 98, in send\n2025-10-21T10:12:14.3085604Z   [Previous line repeated 2 more times]\n2025-10-21T10:12:14.3085641Z   File \"/agents/python/common/azure/core/pipeline/policies/_redirect.py\", line 205, in send\n2025-10-21T10:12:14.3085667Z   File \"/agents/python/common/azure/core/pipeline/_base.py\", line 98, in send\n2025-10-21T10:12:14.3085694Z   File \"/tmp/8de1086b7810c73/antenv/lib/python3.11/site-packages/azure/storage/blob/_shared/policies.py\", line 566, in send\n2025-10-21T10:12:14.3085719Z     response = self.next.send(request)\n2025-10-21T10:12:14.3085743Z                ^^^^^^^^^^^^^^^^^^^^^^^\n2025-10-21T10:12:14.3085768Z   File \"/agents/python/common/azure/core/pipeline/_base.py\", line 98, in send\n2025-10-21T10:12:14.3085793Z   File \"/agents/python/common/azure/core/pipeline/_base.py\", line 98, in send\n2025-10-21T10:12:14.3085818Z   File \"/agents/python/common/azure/core/pipeline/_base.py\", line 98, in send\n2025-10-21T10:12:14.3085842Z   [Previous line repeated 1 more time]\n2025-10-21T10:12:14.308587Z   File \"/tmp/8de1086b7810c73/antenv/lib/python3.11/site-packages/azure/storage/blob/_shared/policies.py\", line 309, in send\n2025-10-21T10:12:14.3085894Z     response = self.next.send(request)\n2025-10-21T10:12:14.3085929Z                ^^^^^^^^^^^^^^^^^^^^^^^\n2025-10-21T10:12:14.3085955Z   File \"/agents/python/common/azure/core/pipeline/_base.py\", line 98, in send\n2025-10-21T10:12:14.308598Z   File \"/agents/python/common/azure/core/pipeline/_base.py\", line 98, in send\n2025-10-21T10:12:14.3086006Z   File \"/agents/python/common/azure/core/pipeline/_base.py\", line 130, in send\n2025-10-21T10:12:14.3086034Z   File \"/tmp/8de1086b7810c73/antenv/lib/python3.11/site-packages/azure/storage/blob/_shared/base_client.py\", line 360, in send\n2025-10-21T10:12:14.3086123Z     return self._transport.send(request, **kwargs)\n2025-10-21T10:12:14.308615Z            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n2025-10-21T10:12:14.3086177Z   File \"/agents/python/common/azure/core/pipeline/transport/_requests_basic.py\", line 365, in send\n2025-10-21T10:12:14.3086203Z   File \"/agents/python/common/requests/sessions.py\", line 589, in request\n2025-10-21T10:12:14.3086227Z     resp = self.send(prep, **send_kwargs)\n2025-10-21T10:12:14.3086262Z            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n2025-10-21T10:12:14.3086291Z   File \"/agents/python/common/opentelemetry/instrumentation/requests/__init__.py\", line 228, in instrumented_send\n2025-10-21T10:12:14.3086316Z     return wrapped_send(self, request, **kwargs)\n2025-10-21T10:12:14.3086339Z            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n2025-10-21T10:12:14.3086363Z   File \"/agents/python/common/requests/sessions.py\", line 703, in send\n2025-10-21T10:12:14.3086385Z     r = adapter.send(request, **kwargs)\n2025-10-21T10:12:14.3086408Z         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n2025-10-21T10:12:14.3086431Z   File \"/agents/python/common/requests/adapters.py\", line 616, in send\n2025-10-21T10:12:14.3086455Z     self.cert_verify(conn, request.url, verify, cert)\n2025-10-21T10:12:14.308648Z   File \"/agents/python/common/requests/adapters.py\", line 303, in cert_verify\n2025-10-21T10:12:14.3086515Z     raise OSError(\n2025-10-21T10:12:14.3086542Z OSError: Could not find a suitable TLS CA certificate bundle, invalid path: /agents/python/common/certifi/cacert.pem\n```\n## System Information\n\nthis is a python azure webapp, running python 3.11\n\n\nLet me know if you need any more information i will provide it",
    "labels": [],
    "state": "closed",
    "repo": "requests/requests"
  },
  {
    "id": 7048,
    "title": "Cloudflare blocks my api bot, but not when I use http.client?",
    "body": "I apologize for the long title, I was sending api requests to thingiverse.com but my bot wasn't responding back and found out cloudflare is blocking my bot, I did a quick test using http.client library and was getting return code 200. I dug a little deeper and found requests adds user-agent, and tried this work around here https://github.com/psf/requests/issues/5671#issuecomment-1006735307 but still had no luck. Is there anyway I can check what gets sent either from requests or urllib3 since something clearly does if I don't get blocked when I use http.client. I would like to resolve this with requests library so I am not essentially relying on only one method. \n",
    "labels": [
      "Question/Not a bug",
      "actions/autoclose-qa"
    ],
    "state": "closed",
    "repo": "requests/requests"
  },
  {
    "id": 7047,
    "title": "Add Response Status Code to HTTPError Exception",
    "body": "Currently, when \nResponse.raise_for_status()\n raises an \nHTTPError\n, the exception message includes the status code, reason, and URL as a string, but the exception object itself doesn't expose the status code or response object as easily accessible attributes for programmatic error handling.\n\nCurrent behavior (from \nmodels.py\n lines 999-1026):\n\ndef raise_for_status(self):\n    \"\"\"Raises :class:[HTTPError](cci:2://file:///e:/Ideas/New%20solid/requests/src/requests/exceptions.py:54:0-55:33), if one occurred.\"\"\"\n    http_error_msg = \"\"\n    if isinstance(self.reason, bytes):\n        # decode reason...\n        \n    if 400 <= self.status_code < 500:\n        http_error_msg = f\"{self.status_code} Client Error: {reason} for url: {self.url}\"\n    elif 500 <= self.status_code < 600:\n        http_error_msg = f\"{self.status_code} Server Error: {reason} for url: {self.url}\"\n    \n    if http_error_msg:\n        raise HTTPError(http_error_msg, response=self)\n\nWhile the response is passed to the exception, users need to parse the error message string or access exception.response.status_code to get the status code programmatically.\n\nWhat This Feature Will Solve\nBetter Error Handling: Developers can catch \nHTTPError\n and easily branch logic based on specific status codes (e.g., retry on 429, different handling for 401 vs 403) without string parsing\nCleaner Code: Direct attribute access (e.status_code) is more Pythonic than e.response.status_code or parsing strings\nConsistency: Other exception types in Requests already expose relevant attributes directly (e.g., \nJSONDecodeError\n has msg, doc, pos)\nBackward Compatible: Adding attributes doesn't break existing code\n",
    "labels": [
      "Feature Request",
      "actions/autoclose-feat"
    ],
    "state": "closed",
    "repo": "requests/requests"
  },
  {
    "id": 6809,
    "title": "Retry hangs indefinitely for 503 status code",
    "body": "When making a GET request to a URL that returns a 503 status code, the retry strategy causes the code to loop indefinitely, regardless of whether the 503 status code is included in the status_forcelist parameter.\r\n\r\n## Expected Result\r\n\r\nThe retry mechanism should follow the configured retry policy (e.g., retry a specified number of times) and eventually raise an error after the maximum retries.\r\n\r\n## Actual Result\r\n\r\nThe code retries indefinitely without raising an exception or stopping.\r\n\r\n\r\n## Reproduction Steps\r\n\r\n```python\r\nimport requests\r\nfrom requests.adapters import HTTPAdapter, Retry\r\n\r\nurl = \"https://www.floraquatic.com/363-eau-de-mer-et-recifal\"\r\n\r\nsession = requests.Session()\r\n    \r\nretry_strategy = Retry(total=3, backoff_factor=0.5, status_forcelist=[429, 500, 502, 504]) #You can add 503 here, same result is expected\r\n\r\nadapter = HTTPAdapter(max_retries=retry_strategy)\r\n\r\nsession.mount(\"https://\", adapter)\r\n\r\n\r\n\r\ntry:\r\n    response = session.get(url)\r\n    \r\n    html_content = response.text\r\n    \r\nexcept Exception as e:\r\n    print(str(e))\r\n\r\n```\r\n\r\n## System Information\r\n\r\n    $ python -m requests.help\r\n\r\n```json\r\n{\r\n  \"chardet\": {\r\n    \"version\": null\r\n  },\r\n  \"charset_normalizer\": {\r\n    \"version\": \"3.4.0\"\r\n  },\r\n  \"cryptography\": {\r\n    \"version\": \"43.0.1\"\r\n  },\r\n  \"idna\": {\r\n    \"version\": \"3.10\"\r\n  },\r\n  \"implementation\": {\r\n    \"name\": \"CPython\",\r\n    \"version\": \"3.11.9\"\r\n  },\r\n  \"platform\": {\r\n    \"release\": \"5.15.0-122-generic\",\r\n    \"system\": \"Linux\"\r\n  },\r\n  \"pyOpenSSL\": {\r\n    \"openssl_version\": \"30300020\",\r\n    \"version\": \"24.2.1\"\r\n  },\r\n  \"requests\": {\r\n    \"version\": \"2.32.3\"\r\n  },\r\n  \"system_ssl\": {\r\n    \"version\": \"30000020\"\r\n  },\r\n  \"urllib3\": {\r\n    \"version\": \"1.26.20\"\r\n  },\r\n  \"using_charset_normalizer\": true,\r\n  \"using_pyopenssl\": true\r\n}\r\n```\r\n\r\n<!-- This command is only available on Requests v2.16.4 and greater. Otherwise,\r\nplease provide some basic information about your system (Python version,\r\noperating system, &c). -->\r\n",
    "labels": [],
    "state": "closed",
    "repo": "requests/requests"
  },
  {
    "id": 7045,
    "title": "About connection release when maintaining sessions",
    "body": "While using the requests library for HTTP requests, I noticed that there were many TCP connections in the FIN_WAIT2 state on the server. Through code analysis, I found that these connections originated from the connection pool created by the underlying urllib3 library used by the requests library.\n\nThe application needs to provide services at any time, so it created a session object that is reused throughout the entire process lifecycle, and it does not actively call the `session.close()` method before the process ends.\n\nAfter reading the source code, I discovered that the requests library only retrieves a connection from the connection pool when making a new HTTP request. It checks whether the connection is available, and if not, it immediately closes the connection and creates a new one. After receiving an HTTP response, the connection is returned to the connection pool. These connections remain idle until the next request arrives.\n\nIs this the actual situation?\n\nIf so, then when the server actively closes the connection (by sending a FIN packet at the TCP protocol layer), the requests library does not detect this state change (it does not have a daemon thread continuously checking the connection status). As a result, the server sees many connections in the FIN_WAIT2 state that have been open for a long time. What is the rationale behind this design?\n\nThank you very much!",
    "labels": [
      "Question/Not a bug",
      "actions/autoclose-qa"
    ],
    "state": "closed",
    "repo": "requests/requests"
  },
  {
    "id": 6807,
    "title": "what is the point of this line?",
    "body": "https://github.com/psf/requests/blame/7335bbf480adc8e6aa88feb2022797a549a00aa3/src/requests/sessions.py#L746",
    "labels": [],
    "state": "closed",
    "repo": "requests/requests"
  },
  {
    "id": 7039,
    "title": "Type hint needed",
    "body": "Type hint helps to write better code, but in requests there's basically none",
    "labels": [],
    "state": "closed",
    "repo": "requests/requests"
  },
  {
    "id": 6647,
    "title": "Wrong CA Certificates used in requests.Session.send",
    "body": "Bug in requests.sessions.py:\r\n\r\nhttps://github.com/psf/requests/blob/b8be93a721792deeadd2f498b8f77cf610e7765f/src/requests/sessions.py#L579-L589\r\n\r\nsession.merge_environment_settings is called in session.request and not in session.send which means if users want to build their own prepared requests (see example below), the correct certificates file will not be used unless explicitly passed to send.\r\n\r\nI believe these environment settings should be updated in session.send instead.\r\n\r\n## Reproduction Steps\r\n\r\n```python\r\nimport os\r\nimport requests\r\n\r\n# Set CA certificates file to custom local file\r\nos.environ[\"REQUESTS_CA_BUNDLE\"] = \"/etc/ssl/certs/ca-certificates.crt\"\r\n\r\n# Create request object\r\nreq = requests.Request(\r\n    method=\"GET\", # any method\r\n    url=\"https://www.example_site.mydomain.com/path\" # any url for which the default cert file does not have a cert for\r\n)\r\n\r\nwith requests.Session() as s:\r\n    respA = s.request( # Success: will use CA certificates from REQUESTS_CA_BUNDLE\r\n        method=req.method,\r\n        url=req.url\r\n    )\r\n    assert respA.status_code == 200\r\n    \r\nwith requests.Session() as s:\r\n    respB = s.send( # Success: will use CA certificates from REQUESTS_CA_BUNDLE if explicitly specified\r\n        request=req.prepare(), verify=os.environ[\"REQUESTS_CA_BUNDLE\"]\r\n    )\r\n    \r\n    assert respB.status_code == 200\r\n    \r\nwith requests.Session() as s:\r\n    respC = s.send( # Error: Will try to use default CA certificates instead of those specified by REQUESTS_CA_BUNDLE\r\n        request=req.prepare() \r\n    )\r\n    \r\n    assert respC.status_code == 200\r\n```\r\n\r\n## Expected Result\r\n\r\nNo output\r\n\r\n## Actual Result\r\n\r\n```\r\nrequests.exceptions.SSLError: HTTPSConnectionPool(host='https://www.example_site.mydomain.com/path', port=443): Max retries exceeded with url: /path (Caused by SSLError(SSLCertVerificationError(1, '[SSL: CERTIFICATE_VERIFY_FAILED] certificate verify failed: unable to get local issuer certificate (_ssl.c:997)')))\r\n```\r\n\r\n## System Information\r\n\r\n    $ python -m requests.help\r\n\r\n```json\r\n{\r\n  \"chardet\": {\r\n    \"version\": null\r\n  },\r\n  \"charset_normalizer\": {\r\n    \"version\": \"3.3.2\"\r\n  },\r\n  \"cryptography\": {\r\n    \"version\": \"\"\r\n  },\r\n  \"idna\": {\r\n    \"version\": \"3.6\"\r\n  },\r\n  \"implementation\": {\r\n    \"name\": \"CPython\",\r\n    \"version\": \"3.10.4\"\r\n  },\r\n  \"platform\": {\r\n    \"release\": \"5.4.0-150-generic\",\r\n    \"system\": \"Linux\"\r\n  },\r\n  \"pyOpenSSL\": {\r\n    \"openssl_version\": \"\",\r\n    \"version\": null\r\n  },\r\n  \"requests\": {\r\n    \"version\": \"2.31.0\"\r\n  },\r\n  \"system_ssl\": {\r\n    \"version\": \"30000020\"\r\n  },\r\n  \"urllib3\": {\r\n    \"version\": \"2.2.1\"\r\n  },\r\n  \"using_charset_normalizer\": true,\r\n  \"using_pyopenssl\": false\r\n}\r\n```\r\n",
    "labels": [],
    "state": "closed",
    "repo": "requests/requests"
  },
  {
    "id": 6730,
    "title": "Certificate loading regression with HTTPAdapters in 2.32.3",
    "body": "<!-- Summary. -->\r\n\r\nIt appears that in version `2.32.3` default certificates are no longer loaded for custom `HTTPAdapter` contexts when they were previously.\r\n\r\nI guess this might be a duplicate/related to https://github.com/psf/requests/issues/6726#issuecomment-2138406456.\r\nAlso related to https://github.com/psf/requests/pull/6710#issuecomment-2137802782 - adding `load_default_certs()` resolves the issue, but this wasn't required in previous versions and thus makes upgrading to `2.32.3` breaking.\r\n\r\n## Expected Result\r\n\r\n<!-- What you expected. -->\r\n\r\nWith the code below using `requests` version `2.32.2` I get the URL content with no error.\r\n\r\n## Actual Result\r\n\r\n<!-- What happened instead. -->\r\n\r\nUsing `2.32.3` I get:\r\n```\r\nrequests.exceptions.SSLError: HTTPSConnectionPool(host='raw.githubusercontent.com', port=443): Max retries exceeded with url: /psf/requests/main/MANIFEST.in (Caused by SSLError(SSLCertVerificationError(1, '[SSL: CERTIFICATE_VERIFY_FAILED] certificate verify failed: unable to get local issuer certificate (_ssl.c:1006)')))\r\n```\r\n\r\n## Reproduction Steps\r\n\r\n```python\r\nimport requests\r\nimport ssl\r\nfrom requests.adapters import HTTPAdapter, DEFAULT_POOLBLOCK\r\nfrom urllib3.util.ssl_ import create_urllib3_context\r\n\r\n# adapted from https://github.com/IBM/python-sdk-core/blob/1c207385de627df5d12fd0a0ebd04717ce5bb29d/ibm_cloud_sdk_core/utils.py#L34\r\nclass SSLHTTPAdapter(HTTPAdapter):\r\n    \"\"\"Wraps the original HTTP adapter and adds additional SSL context.\"\"\"\r\n\r\n    def init_poolmanager(self, connections, maxsize, block=DEFAULT_POOLBLOCK, **pool_kwargs):\r\n        \"\"\"Create and use custom SSL configuration.\"\"\"\r\n\r\n        ssl_context = create_urllib3_context()\r\n        ssl_context.minimum_version = ssl.TLSVersion.TLSv1_2\r\n        # ssl_context.load_default_certs() # Adding this resolves the certificate issue but it was not required before\r\n\r\n        super().init_poolmanager(connections, maxsize, block, ssl_context=ssl_context, **pool_kwargs)\r\n\r\nsession = requests.Session()\r\nhttp_adapter = SSLHTTPAdapter()\r\nsession.mount('https://', http_adapter)\r\n\r\nprint(session.get(url='https://raw.githubusercontent.com/psf/requests/main/MANIFEST.in').text)\r\n```\r\n\r\n## System Information\r\n\r\n    $ python -m requests.help\r\n\r\n```json\r\n{\r\n  \"chardet\": {\r\n    \"version\": null\r\n  },\r\n  \"charset_normalizer\": {\r\n    \"version\": \"3.2.0\"\r\n  },\r\n  \"cryptography\": {\r\n    \"version\": \"\"\r\n  },\r\n  \"idna\": {\r\n    \"version\": \"3.4\"\r\n  },\r\n  \"implementation\": {\r\n    \"name\": \"CPython\",\r\n    \"version\": \"3.11.9\"\r\n  },\r\n  \"platform\": {\r\n    \"release\": \"23.5.0\",\r\n    \"system\": \"Darwin\"\r\n  },\r\n  \"pyOpenSSL\": {\r\n    \"openssl_version\": \"\",\r\n    \"version\": null\r\n  },\r\n  \"requests\": {\r\n    \"version\": \"2.32.3\"\r\n  },\r\n  \"system_ssl\": {\r\n    \"version\": \"30300000\"\r\n  },\r\n  \"urllib3\": {\r\n    \"version\": \"2.2.1\"\r\n  },\r\n  \"using_charset_normalizer\": true,\r\n  \"using_pyopenssl\": false\r\n}\r\n```\r\n\r\n<!-- This command is only available on Requests v2.16.4 and greater. Otherwise,\r\nplease provide some basic information about your system (Python version,\r\noperating system, &c). -->\r\n",
    "labels": [],
    "state": "closed",
    "repo": "requests/requests"
  },
  {
    "id": 6794,
    "title": "Requests changes the URL on GET",
    "body": "When fetching a URL containing `%2c` with GET, the URL gets modified and `%2c` is replaced by `%2C`.\r\n\r\nThe problem with this is that the server may return a 404 when using `%2C` even if the resource exists when looking for it using `%2c` (i.e.: the server is expecting you to honor the lower-case encoding). This should not be the case since [URL percent-encoding is case insensitive](https://stackoverflow.com/questions/7994287/is-url-percent-encoding-case-sensitive), but actual servers may not comply with that and require you to use lower case.\r\n\r\nThis comes from a real use case where the server is generating and providing a URL to download a file, and refuses to reply with the file unless `%2c` is used (instead of `%2C`).\r\n\r\n## Expected Result\r\n\r\nRequests should not modify the URL, since `%2c` is already encoded (and lower-case is just as valid encoding as upper-case).\r\n\r\nThis expected behavior can be found when using other libraries like `httpx`.\r\n\r\n## Actual Result\r\n\r\nRequests modifies the URL, changing `%2c` to `%2C`.\r\n\r\n## Reproduction Steps\r\n\r\n```py\r\nurl = \"https://domain.com/foo/bar%2cbaz.pdf\"\r\nresponse = requests.get(url)\r\n\r\nprint(url)           # https://domain.com/foo/bar%2cbaz.pdf\r\nprint(response.url)  # https://domain.com/foo/bar%2Cbaz.pdf\r\n```\r\n\r\n## System Information\r\n\r\n    $ python -m requests.help\r\n\r\n```json\r\n{\r\n  \"chardet\": {\r\n    \"version\": \"5.2.0\"\r\n  },\r\n  \"charset_normalizer\": {\r\n    \"version\": \"3.3.2\"\r\n  },\r\n  \"cryptography\": {\r\n    \"version\": \"\"\r\n  },\r\n  \"idna\": {\r\n    \"version\": \"3.4\"\r\n  },\r\n  \"implementation\": {\r\n    \"name\": \"CPython\",\r\n    \"version\": \"3.11.5\"\r\n  },\r\n  \"platform\": {\r\n    \"release\": \"6.10.6-200.fc40.x86_64\",\r\n    \"system\": \"Linux\"\r\n  },\r\n  \"pyOpenSSL\": {\r\n    \"openssl_version\": \"\",\r\n    \"version\": null\r\n  },\r\n  \"requests\": {\r\n    \"version\": \"2.32.3\"\r\n  },\r\n  \"system_ssl\": {\r\n    \"version\": \"300000c0\"\r\n  },\r\n  \"urllib3\": {\r\n    \"version\": \"2.0.7\"\r\n  },\r\n  \"using_charset_normalizer\": false,\r\n  \"using_pyopenssl\": false\r\n}\r\n```\r\n",
    "labels": [],
    "state": "closed",
    "repo": "requests/requests"
  },
  {
    "id": 7031,
    "title": "AI Bug Analysis: ReadTimeout exception HTTPSConnectionPool(host='domain.com', port=443): Read timed out. (read timeout=10)",
    "body": "### \ud83e\udd16 Bug Report\n\n**Original Error:**\n```\nReadTimeout exception HTTPSConnectionPool(host='domain.com', port=443): Read timed out. (read timeout=10)\n```\n\n--- \n\n### \ud83d\udd2c Root Cause Analysis\nThe error message you're encountering, `ReadTimeout exception HTTPSConnectionPool(host='domain.com', port=443): Read timed out. (read timeout=10)`, indicates that a request made to `https://domain.com` on port 443 did not receive a response within the specified timeout period, which in this case is 10 seconds. This timeout setting dictates how long the client will wait for a server to send a response before giving up and raising an error.\n\nBased on the provided code context, which involves tests using the `requests` library to make HTTP requests, there are a few potential root causes for this issue:\n\n1. **Server Response Delay:** The server at `domain.com` might be taking too long to respond to requests. This could be due to server-side processing delays, heavy load on the server, or network latency issues. The server's response time exceeds the specified timeout of 10 seconds, leading to a `ReadTimeout` exception.\n\n2. **Network Issues:** There could be network connectivity issues between the client (the machine running the test code) and the server (`domain.com`). This includes low bandwidth, high latency, or intermittent connectivity that results in requests taking longer than expected to complete.\n\n3. **Timeout Configuration:** A timeout of 10 seconds might be too short for the request to complete successfully, especially if the request is complex, the server is intentionally delaying responses (e.g., for rate limiting), or if there are known network delays. \n\n4. **Test Server Configuration:** The code snippets provided indicate the use of a `TLSServer` for testing purposes, with various configurations including expired and valid certificates. If the `ReadTimeout` error is occurring during these tests, it's possible that the test server setup (e.g., `TLSServer`) is not correctly handling requests or is intentionally slow to respond as part of the test scenario. However, the error message specifically mentions `domain.com`, which suggests the issue is more likely related to an actual network request rather than the local test server setup.\n\n5. **Client Configuration:** The client configuration, particularly the session and request setup in the `requests` library, might be contributing to the issue. For example, if the client is not correctly handling HTTP keep-alive connections or if there's an issue with the way requests are being sent (e.g., large payloads, incorrect headers), it could lead to delays and timeouts.\n\nTo address this issue, consider the following steps:\n\n- **Increase the Timeout:** Temporarily increase the timeout value to see if the request eventually succeeds. This can help determine if the timeout is simply too short for the given operation.\n- **Server Investigation:** Check the server's health, load, and response times to see if there are any issues that could be causing delays.\n- **Network Diagnostics:** Run network diagnostics to check for any connectivity issues between the client and the server.\n- **Review Test Configuration:** If the issue is occurring during testing with `TLSServer`, review the server setup and ensure it's designed to respond in a timely manner.\n- **Client Request Review:** Examine the client request configuration for any potential issues that could be optimized to prevent timeouts.\n\nIn summary, the `ReadTimeout` exception is typically a symptom of the client not receiving a response from the server within the specified timeout period. Identifying the root cause requires investigating server response times, network connectivity, timeout settings, and both client and server configurations.\n\n--- \n\n### \ud83d\udee0\ufe0f Suggested Fix\nGiven the root cause analysis, the primary issue seems to be related to the timeout setting being too short for the request to complete successfully under certain conditions. To address this, we can adjust the timeout settings in the `requests` library usage within the provided test cases. This involves modifying the `requests.Session().get()` method calls to include a longer timeout period.\n\nHere's a code snippet that demonstrates how to adjust the timeout setting:\n\n```python\nimport requests\nimport threading\nfrom your_tls_server_module import TLSServer  # Assuming this is a custom module or similar\n\n# Example function to demonstrate adjusting the timeout\ndef test_with_increased_timeout():\n    s = requests.Session()\n    close_server = threading.Event()\n    server = TLSServer(\n        handler=response_handler,  # Assuming this is defined elsewhere\n        wait_to_close_event=close_server,\n        requests_to_handle=3,\n        cert_chain=\"tests/certs/valid/server/server.pem\",\n        keyfile=\"tests/certs/valid/server/server.key\",\n    )\n\n    with server as (host, port):\n        url = f\"https://{host}:{port}\"\n        # Increase the timeout from the default (or previously set) value to 30 seconds\n        r1 = s.get(url, verify=False, timeout=30)  # Adjusted timeout here\n        assert r1.status_code == 200\n\n        # Use the increased timeout for other requests as well\n        r2 = s.get(url, verify=\"tests/certs/valid/ca/ca.crt\", timeout=30)  # Adjusted timeout here\n        assert r2.status_code == 200\n\n        close_server.set()\n\n# Ensure to adjust the timeout in other relevant parts of your code as well\n```\n\n### Explanation of the Fix:\n\n- **Timeout Adjustment:** The key change in this snippet is the inclusion of the `timeout=30` parameter in the `s.get()` method calls. This increases the timeout duration from the default 10 seconds to 30 seconds, providing additional time for the server to respond before a `ReadTimeout` exception is raised.\n\n- **Why Increase the Timeout?:** Based on the root cause analysis, the server might need more time to process requests under certain conditions (e.g., high load, complex operations, network latency). Increasing the timeout gives the server a reasonable buffer to complete the request and respond.\n\n- **Impact of the Change:** This change should reduce or eliminate the occurrence of `ReadTimeout` exceptions under normal operating conditions by allowing more time for requests to complete. However, it's important to monitor the impact of this change, as significantly increasing timeouts could lead to longer waits in scenarios where a server or network issue prevents a response.\n\n- **General Recommendation:** Always consider the specific context and requirements of your application when adjusting timeout settings. While increasing the timeout can solve immediate timeout issues, it's also crucial to investigate and address the underlying causes of delayed responses (e.g., server performance, network configuration).",
    "labels": [],
    "state": "closed",
    "repo": "requests/requests"
  },
  {
    "id": 7029,
    "title": "One request fails, but others don't; it also succeeds in terminal",
    "body": "I checked a lot of trouble-shoot topics, but didn't find what might be wrong here...\n\nI'm going off this API documentation: https://kritsel.github.io/tado-openapispec-v2/swagger\n\nThis code:\n```\nimport requests\nimport json\n\n\nurl1 = \"https://my.tado.com/api/v2/homes/[myzone]/zones/2/schedule/activeTimeTable\"\nurl2 = \"https://my.tado.com/api/v2/homes/[myzone]/zones/2/details\"\n\ntoken = \"[mytoken]\"\n\nheaders = {\n    'Authorization': \"Bearer \"+token,\n    'User-Agent': 'python/libtado',\n}\n\ndata1 = {\"id\": 1}\ndata2 = {\"name\": \"Eetkamer\"}\n\n\ntimeout = 15\n\nr1 = requests.put(url1, headers=headers, json=data1, timeout=timeout)\nr2 = requests.put(url2, headers=headers, json=data2, timeout=timeout)\n\nprint(\"###################\")\n\nprint(r1)\nprint(\"-------------------\")\nr1.status_code\nprint(\"-------------------\")\nprint(r1)\n\nprint(\"###################\")\n\nprint(r2)\nprint(\"-------------------\")\nr2.status_code\nprint(\"-------------------\")\nprint(r2)\n\nprint(\"###################\")\n```\n... results in this output:\n```\nPS C:\\Git\\requests-set-schedule-tado> python requests-test.py\n###################\n<Response [403]>\n-------------------\n-------------------\n<Response [403]>\n###################\n<Response [200]>\n-------------------\n-------------------\n<Response [200]>\n###################\n```\n\nBut when I make that HTTP request to `https://my.tado.com/api/v2/homes/[myzone]/zones/2/schedule/activeTimeTable` in PowerShell, the response is `200`...:\n```\nPS C:\\Git\\requests-set-schedule-tado> Invoke-WebRequest -UseBasicParsing -Uri \"https://my.tado.com/api/v2/homes/[myzone]/zones/2/schedule/activeTimetable\" `\n>> -Method \"PUT\" `\n>> -WebSession $session `\n>> -Headers @{\n>>   \"accept\"=\"application/json\"\n>>   \"authorization\"=\"Bearer [mytoken]\"\n>> } `\n>> -ContentType \"application/json\" `\n>> -Body \"{`\"id`\":1}\"\n\nStatusCode        : 200\nStatusDescription : OK\nContent           : {\"id\":1,\"type\":\"THREE_DAY\"}\nRawContent        : HTTP/1.1 200 OK\n                    Date: Fri, 12 Sep 2025 17:57:29 GMT\n                    Transfer-Encoding: chunked\n                    Connection: keep-alive\n                    Vary: origin\n                    Vary: access-control-request-method\n                    Vary: access-control-request-headers\n                    Vary:\u2026\nHeaders           : {[Date, System.String[]], [Transfer-Encoding, System.String[]], [Connection, System.String[]], [Vary, System.String[]]\u2026}\nImages            : {}\nInputFields       : {}\nLinks             : {}\nRawContentLength  : 27\nRelationLink      : {}\n```\n\nCould someone guide me to a solution?\n\nThanks in advance!\n\nPS Obviously, [myzone] and [mytoken] are placeholders for privacy reasons.",
    "labels": [
      "Question/Not a bug",
      "actions/autoclose-qa"
    ],
    "state": "closed",
    "repo": "requests/requests"
  },
  {
    "id": 7028,
    "title": "Tor request ",
    "body": "Hello, does requests allow you to make requests on Tor URLs, URLs in .onnion, or is this project not suitable? ",
    "labels": [
      "Question/Not a bug",
      "actions/autoclose-qa"
    ],
    "state": "closed",
    "repo": "requests/requests"
  },
  {
    "id": 7027,
    "title": "@ziavai777",
    "body": "@ziavai777 \n\n_Originally posted by @ziavai777 in https://github.com/psf/requests/issues/7022#issuecomment-3257584392_",
    "labels": [],
    "state": "closed",
    "repo": "requests/requests"
  },
  {
    "id": 6751,
    "title": "requests > 2.31.0 - Unhashable type 'list' for 'cert' parameter",
    "body": "### Subject\r\n\r\nThe requests.get() parameter used to accept 'cert' as a tuple or list, and this may be a regression from #1165 \r\n\r\n### Environment\r\n\r\nAll\r\n\r\n### Steps to Reproduce\r\n\r\n```\r\n>>> import requests\r\n>>> requests.get('https://localhost:8080/asdf', cert=['client-cert.pem', 'client-key.pem'], verify='ca-cert.pem')\r\nTraceback (most recent call last):\r\n<snip>\r\nTypeError: unhashable type: 'list'\r\n>>> requests.get('https://localhost:8080/asdf', cert=('client-cert.pem', 'client-key.pem'), verify='ca-cert.pem')\r\n<Response [200]>\r\n```\r\n\r\n### Expected Behavior\r\n\r\nFrom requests == 2.31.0:\r\n```\r\n>>> import requests\r\n>>> requests.get('https://localhost:8080/asdf'', cert=['client-cert.pem', 'client-key.pem'], verify='ca-cert.pem')\r\n<Response [200]>\r\n```\r\n",
    "labels": [],
    "state": "closed",
    "repo": "requests/requests"
  },
  {
    "id": 7022,
    "title": "create_db.py",
    "body": "<!-- Summary. -->\r\n\r\n## Expected Result\r\n\r\n<!-- What you expected. -->\r\n\r\n## Actual Result\r\n\r\n<!-- What happened instead. -->\r\n\r\n## Reproduction Steps\r\n\r\n```python\r\nimport requests\r\n\r\n```\r\n\r\n## System Information\r\n\r\n    $ python -m requests.help\r\n\r\n```json\r\n{\r\n  \"paste\": \"here\"\r\n}\r\n```\r\n\r\n<!-- This command is only available on Requests v2.16.4 and greater. Otherwise,\r\nplease provide some basic information about your system (Python version,\r\noperating system, &c). -->\r\n    ",
    "labels": [],
    "state": "closed",
    "repo": "requests/requests"
  },
  {
    "id": 6800,
    "title": "AttributeError: 'Request' object has no attribute 'authorize'",
    "body": "There seems to be a call to request.authorize. Shouldn't that be request.auth?\r\n\r\n```python\r\nimport requests\r\nrequests.get(\"https://google.com\").raise_for_status()\r\n```\r\n\r\n## Error\r\n```\r\nTraceback (most recent call last):\r\n  File \"<frozen runpy>\", line 198, in _run_module_as_main\r\n  File \"<frozen runpy>\", line 88, in _run_code\r\n  File \"/home/user/my_lib/__main__.py\", line 23, in <module>\r\n    requests.get(\"https://google.com\").raise_for_status()\r\n    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\r\n  File \"/home/user/my_lib/.venv/lib/python3.11/site-packages/requests/api.py\", line 73, in get\r\n    return request(\"get\", url, params=params, **kwargs)\r\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\r\n  File \"/home/user/my_lib/.venv/lib/python3.11/site-packages/requests/api.py\", line 59, in request\r\n    return session.request(method=method, url=url, **kwargs)\r\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\r\n  File \"/home/user/my_lib/.venv/lib/python3.11/site-packages/requests/sessions.py\", line 575, in request\r\n    prep = self.prepare_request(req)\r\n           ^^^^^^^^^^^^^^^^^^^^^^^^^\r\n  File \"/home/user/my_lib/.venv/lib/python3.11/site-packages/requests/sessions.py\", line 479, in prepare_request\r\n    auth = request.authorize\r\n```\r\n\r\n\r\n## System Information\r\n\r\n    $ python -m requests.help\r\n\r\n```json\r\n{\r\n  \"chardet\": {\r\n    \"version\": null\r\n  },\r\n  \"charset_normalizer\": {\r\n    \"version\": \"3.3.2\"\r\n  },\r\n  \"cryptography\": {\r\n    \"version\": \"\"\r\n  },\r\n  \"idna\": {\r\n    \"version\": \"3.8\"\r\n  },\r\n  \"implementation\": {\r\n    \"name\": \"CPython\",\r\n    \"version\": \"3.11.9\"\r\n  },\r\n  \"platform\": {\r\n    \"release\": \"6.10.3-amd64\",\r\n    \"system\": \"Linux\"\r\n  },\r\n  \"pyOpenSSL\": {\r\n    \"openssl_version\": \"\",\r\n    \"version\": null\r\n  },\r\n  \"requests\": {\r\n    \"version\": \"2.32.3\"\r\n  },\r\n  \"system_ssl\": {\r\n    \"version\": \"30300010\"\r\n  },\r\n  \"urllib3\": {\r\n    \"version\": \"2.2.2\"\r\n  },\r\n  \"using_charset_normalizer\": true,\r\n  \"using_pyopenssl\": false\r\n}\r\n```\r\n\r\n<!-- This command is only available on Requests v2.16.4 and greater. Otherwise,\r\nplease provide some basic information about your system (Python version,\r\noperating system, &c). -->\r\n",
    "labels": [],
    "state": "closed",
    "repo": "requests/requests"
  },
  {
    "id": 6699,
    "title": "AttributeError: 'NoneType' object has no attribute 'setdefault' on environment proxies",
    "body": "AttributeError: 'NoneType' object has no attribute 'setdefault' on environment proxies\r\n\r\nIt appears there is a small bug in \u200e`Session.merge_environment_settings` where the proxies variable can be `None` but setdefault is called on it anyway when env_proxies are present, causing an AttributeError to be thrown:\r\n\r\nhttps://github.com/psf/requests/blob/main/src/requests/sessions.py#L759-L762\r\n",
    "labels": [],
    "state": "closed",
    "repo": "requests/requests"
  },
  {
    "id": 6542,
    "title": "Cookies with `Secure` are not sent for `localhost` via unencrypted `http`",
    "body": "See the title, `Secure` cookies are not sent in requests to `localhost` if those requests are not encrypted. There should probably be an exception for `localhost` (as there is in browsers, as well) to aid in developing servers.\r\n\r\n## Expected Result\r\n\r\nThe cookies should be sent with the request.\r\n\r\n## Actual Result\r\n\r\nThey aren't.\r\n\r\n## Reproduction Steps\r\n\r\n```python\r\nimport requests\r\n\r\nsession = requests.Session()\r\nsession.post(\"http://localhost:8080/login\")\r\nsession.get(\"http://localhost:8080/only-with-login\").raise_for_status()\r\n```\r\n\r\nand\r\n\r\n```python\r\nfrom flask import Flask, request, make_response\r\n\r\napp = Flask(__name__)\r\n\r\n\r\n@app.route(\"/login\")\r\ndef login():\r\n    resp = make_response(\"Logged in\")\r\n    resp.set_cookie(\"token\", \"token\", secure=True)\r\n    return resp\r\n\r\n\r\n@app.route(\"/only-with-login\")\r\ndef only_with_login():\r\n    if request.cookies.get(\"token\") != \"token\":\r\n        return \"Not logged in\", 403\r\n    return \"Logged in\"\r\n```\r\n\r\nRunning the flask app with `flask --app server run --port 8080` and then running the requests with `python3 do_requests.py` throws an exception in `do_requests`, while in a browser the page does show \"Logged in\" after visiting `http://localhost:8080/login`.\r\n\r\n## System Information\r\n\r\n    $ python -m requests.help\r\n\r\n```json\r\n{\r\n  \"chardet\": {\r\n    \"version\": \"5.2.0\"\r\n  },\r\n  \"charset_normalizer\": {\r\n    \"version\": \"3.2.0\"\r\n  },\r\n  \"cryptography\": {\r\n    \"version\": \"41.0.3\"\r\n  },\r\n  \"idna\": {\r\n    \"version\": \"3.4\"\r\n  },\r\n  \"implementation\": {\r\n    \"name\": \"CPython\",\r\n    \"version\": \"3.11.5\"\r\n  },\r\n  \"platform\": {\r\n    \"release\": \"6.5.4-arch2-1\",\r\n    \"system\": \"Linux\"\r\n  },\r\n  \"pyOpenSSL\": {\r\n    \"openssl_version\": \"30100020\",\r\n    \"version\": \"23.2.0\"\r\n  },\r\n  \"requests\": {\r\n    \"version\": \"2.28.2\"\r\n  },\r\n  \"system_ssl\": {\r\n    \"version\": \"30100030\"\r\n  },\r\n  \"urllib3\": {\r\n    \"version\": \"1.26.15\"\r\n  },\r\n  \"using_charset_normalizer\": false,\r\n  \"using_pyopenssl\": true\r\n}\r\n```\r\n\r\n<!-- This command is only available on Requests v2.16.4 and greater. Otherwise,\r\nplease provide some basic information about your system (Python version,\r\noperating system, &c). -->\r\n",
    "labels": [],
    "state": "closed",
    "repo": "requests/requests"
  },
  {
    "id": 7024,
    "title": "About request.Session",
    "body": "Hi, I have a special scenarios that there is a process called A continuously produces data while a process called B post the data to a url, The following is a fragment of  process B pseudocode:\n```\nwith requests.Session as session:\n  while True:\n    data = queue.get()\n    response = make_request(data, session)\n\n```\nThe loop above is expected to continue even if an exception occurs, so the question is:\nIf something wrong causes session invalid, does it throw exceptions \uff1f if so, how to handle it so the loop continues ?",
    "labels": [
      "Question/Not a bug",
      "actions/autoclose-qa"
    ],
    "state": "closed",
    "repo": "requests/requests"
  },
  {
    "id": 7021,
    "title": "@ziavai777",
    "body": "https://github.com/github/docs/blob/copilot%2Ffix-25f9b251-c980-44a4-8435-396c8e724065/contributing%2Fimages%2Fcontribution_cta.png",
    "labels": [],
    "state": "closed",
    "repo": "requests/requests"
  },
  {
    "id": 7020,
    "title": "Reqable docs",
    "body": "https://github.com/reqable/reqable-docs/commit/ec6996417961340b1df9ffa554d3286e767387af",
    "labels": [],
    "state": "closed",
    "repo": "requests/requests"
  },
  {
    "id": 7018,
    "title": "Remove unused argument from _urllib3_request_context",
    "body": "in `src/requests/adapters.py` the `_urllib3_request_context` takes a 4th argument `poolmanger` that is not used in the function at all.\n\nThe `_urllib3_request_context` is only used in one place (in the same file). I can make a PR to remove the extra argument, if that's okay?\n\nI took the liberty of making the change on my machine and got `595 passed, 15 skipped, 1 xfailed, 18 warnings in 72.78s (0:01:12)` as the result.",
    "labels": [],
    "state": "closed",
    "repo": "requests/requests"
  },
  {
    "id": 6954,
    "title": "class HeaderDict(rest_requests.packages.urllib3._collections.HTTPHeaderDict): AttributeError: module 'requests' has no attribute 'packages'",
    "body": "> fix released in 2.17.2! \n\n _Originally posted by @kennethreitz in [#4104](https://github.com/psf/requests/issues/4104#issuecomment-304734015)_\n\nIm using requests 2.32.3 with djangorestframework 3.16.0 but im still having the same problem: This [commit](https://github.com/requests/requests/commit/588e8f7f640f774e71d61b53ccb34d310172e0ad) seems to have broken requests.packages.\n\n from rest_framework.test import APITestCase\n<frozen importlib._bootstrap>:1360: in _find_and_load\n    ???\n<frozen importlib._bootstrap>:1331: in _find_and_load_unlocked\n    ???\n<frozen importlib._bootstrap>:935: in _load_unlocked\n    ???\n..\\.venv\\Lib\\site-packages\\_pytest\\assertion\\rewrite.py:185: in exec_module\n    exec(co, module.__dict__)\n..\\.venv\\Lib\\site-packages\\rest_framework\\test.py:27: in <module>\n    class HeaderDict(rest_requests.packages.urllib3._collections.HTTPHeaderDict):\nAttributeError: module 'requests' has no attribute 'packages'\nERROR users/tests.py - AttributeError: module 'requests' has no attribute 'packages'\n\nSomebody please help me",
    "labels": [],
    "state": "closed",
    "repo": "requests/requests"
  },
  {
    "id": 7006,
    "title": "ModuleNotFoundError",
    "body": "  File \"/usr/lib/python3.13/site-packages/requests/__init__.py\", line 43, in <module>\n    import urllib3\n  File \"/usr/lib/python3.13/site-packages/urllib3/__init__.py\", line 14, in <module>\n    from . import exceptions\n  File \"/usr/lib/python3.13/site-packages/urllib3/exceptions.py\", line 7, in <module>\n    from http.client import IncompleteRead as httplib_IncompleteRead\nModuleNotFoundError: No module named 'http.client'; 'http' is not a package",
    "labels": [],
    "state": "closed",
    "repo": "requests/requests"
  },
  {
    "id": 7002,
    "title": "Teat",
    "body": null,
    "labels": [],
    "state": "closed",
    "repo": "requests/requests"
  },
  {
    "id": 6775,
    "title": "With setuptools 72.0.0 requests can no longer be installed from git",
    "body": "## Expected Result\r\n\r\n`pip install git+https://github.com/psf/requests` gives me the latest development version of `requests`.\r\n\r\n## Actual Result\r\n\r\nInstallation fails due to [an import in setup.py](https://github.com/psf/requests/blob/main/setup.py#L7):\r\n```\r\nRunning command git clone -q https://github.com/psf/requests /tmp/pip-req-build-bwz96dmd\r\n  ERROR: Command errored out with exit status 1:\r\n   command: /usr/bin/python3.9 /usr/lib/python3.9/site-packages/pip/_vendor/pep517/in_process/_in_process.py get_requires_for_build_wheel /tmp/tmpqmb1elhu\r\n       cwd: /tmp/pip-req-build-bwz96dmd\r\n  Complete output (17 lines):\r\n  Traceback (most recent call last):\r\n    File \"/usr/lib/python3.9/site-packages/pip/_vendor/pep517/in_process/_in_process.py\", line 349, in <module>\r\n      main()\r\n    File \"/usr/lib/python3.9/site-packages/pip/_vendor/pep517/in_process/_in_process.py\", line 331, in main\r\n      json_out['return_val'] = hook(**hook_input['kwargs'])\r\n    File \"/usr/lib/python3.9/site-packages/pip/_vendor/pep517/in_process/_in_process.py\", line 117, in get_requires_for_build_wheel\r\n      return hook(config_settings)\r\n    File \"/tmp/pip-build-env-thl7ju8g/overlay/lib/python3.9/site-packages/setuptools/build_meta.py\", line 327, in get_requires_for_build_wheel\r\n      return self._get_build_requires(config_settings, requirements=[])\r\n    File \"/tmp/pip-build-env-thl7ju8g/overlay/lib/python3.9/site-packages/setuptools/build_meta.py\", line 297, in _get_build_requires\r\n      self.run_setup()\r\n    File \"/tmp/pip-build-env-thl7ju8g/overlay/lib/python3.9/site-packages/setuptools/build_meta.py\", line 497, in run_setup\r\n      super().run_setup(setup_script=setup_script)\r\n    File \"/tmp/pip-build-env-thl7ju8g/overlay/lib/python3.9/site-packages/setuptools/build_meta.py\", line 313, in run_setup\r\n      exec(code, locals())\r\n    File \"<string>\", line 7, in <module>\r\n  ModuleNotFoundError: No module named 'setuptools.command.test'\r\n  ----------------------------------------\r\nWARNING: Discarding git+https://github.com/psf/requests. Command errored out with exit status 1: /usr/bin/python3.9 /usr/lib/python3.9/site-packages/pip/_vendor/pep517/in_process/_in_process.py get_requires_for_build_wheel /tmp/tmpqmb1elhu Check the logs for full command output.\r\nERROR: Command errored out with exit status 1: /usr/bin/python3.9 /usr/lib/python3.9/site-packages/pip/_vendor/pep517/in_process/_in_process.py get_requires_for_build_wheel /tmp/tmpqmb1elhu Check the logs for full command output.\r\n```\r\n\r\nSee the setuptools changelog: https://setuptools.pypa.io/en/stable/history.html#v72-0-0\r\n\r\n> The test command has been removed. Users relying on \u2018setup.py test\u2019 will need to migrate to another test runner or pin setuptools before this version. ([#931](https://github.com/pypa/setuptools/issues/931))\r\n\r\n## Reproduction Steps\r\n\r\nCreate a venv with latest setuptools. Then run `pip install git+https://github.com/psf/requests`.\r\n",
    "labels": [],
    "state": "closed",
    "repo": "requests/requests"
  },
  {
    "id": 7001,
    "title": "Dynamic import causing FileNotFoundError in shrinkwrapped applications after deployment of new versioon",
    "body": "https://github.com/psf/requests/blob/970e8cec988421bd43da57350723b05c8ce8dc7e/src/requests/utils.py#L214\n\nThe dynamic import in the referenced code above is causing errors with shrinkwrapped scripts whenever we try to replace an old version with a new one while an old script is running because the old script execution tries to access a python path that has been replaced by the new version of the script. See the sequence of events below:\n\n1. script.v1.0 running\n2. script.v2.0  is deployed to replacev1.0\n3. running script.v.1.0 makes a POST request and fails at the dynamic upload with FileNotFoundError",
    "labels": [],
    "state": "closed",
    "repo": "requests/requests"
  }
]